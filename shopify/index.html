<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>KABAG å•†å“ãƒšãƒ¼ã‚¸ HTMLç”Ÿæˆã‚¢ãƒ—ãƒª</title>
  <style>
    * { box-sizing: border-box; }
    body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; background: #f5f5f5; margin: 0; padding: 0; color: #333; }
    .app-container { display: flex; height: 100vh; }
    .input-panel { width: 50%; height: 100vh; overflow-y: auto; padding: 20px; background: #fff; border-right: 2px solid #e0e0e0; }
    .preview-panel { width: 50%; height: 100vh; overflow-y: auto; background: #fafafa; }
    .preview-header { position: sticky; top: 0; background: #333; color: #fff; padding: 10px 20px; font-weight: bold; z-index: 100; display: flex; justify-content: space-between; align-items: center; }
    .preview-content { padding: 20px; }
    .preview-iframe { width: 100%; height: calc(100vh - 50px); border: none; background: #fff; }
    h1 { text-align: center; color: #E8960A; margin-bottom: 20px; font-size: 1.3em; }
    h2 { font-size: 1em; border-left: 4px solid #E8960A; padding-left: 12px; margin: 25px 0 12px 0; }
    label { display: block; font-weight: bold; margin-bottom: 5px; font-size: 0.85em; }
    input[type="text"], input[type="url"], textarea, select { width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 6px; font-size: 13px; margin-bottom: 12px; }
    input[type="text"]:focus, input[type="url"]:focus, textarea:focus, select:focus { outline: none; border-color: #E8960A; }
    textarea { min-height: 60px; resize: vertical; }
    .checkbox-group { background: #fafafa; padding: 12px; border-radius: 6px; margin-bottom: 12px; }
    .checkbox-group label { display: flex; align-items: center; font-weight: normal; margin-bottom: 8px; cursor: pointer; font-size: 0.9em; }
    .checkbox-group input[type="checkbox"] { margin-right: 8px; width: 16px; height: 16px; }
    .dynamic-list { background: #fafafa; padding: 12px; border-radius: 6px; margin-bottom: 12px; }
    .dynamic-item { background: #fff; padding: 12px; border-radius: 6px; margin-bottom: 8px; border: 1px solid #e0e0e0; position: relative; }
    .dynamic-item .delete-btn { position: absolute; top: 8px; right: 8px; background: #D94040; color: #fff; border: none; border-radius: 50%; width: 24px; height: 24px; cursor: pointer; font-size: 14px; line-height: 1; display: flex; align-items: center; justify-content: center; z-index: 10; }
    .dynamic-item .delete-btn:hover { background: #B83030; transform: scale(1.1); }
    .color-item { display: flex; align-items: center; padding-right: 40px; }
    .color-item .color-input { flex: 1; margin-bottom: 0; }
    .spec-other-item { padding-right: 40px; }
    .spec-other-inputs { display: flex; gap: 10px; }
    .spec-other-inputs input { flex: 1; margin-bottom: 0; }
    .image-grid-item { position: relative; cursor: pointer; border-radius: 6px; overflow: hidden; }
    .image-grid-item img { width: 80px; height: 80px; object-fit: cover; border-radius: 6px; border: 3px solid transparent; transition: all 0.2s; }
    .image-grid-item.selected img { border-color: #3D9B46; }
    .image-grid-item.used img { opacity: 0.4; }
    .image-grid-item.used::after { content: 'è¿½åŠ æ¸ˆ'; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: rgba(0,0,0,0.7); color: #fff; padding: 4px 8px; border-radius: 4px; font-size: 10px; }
    .image-grid-item .checkmark { position: absolute; top: 2px; right: 2px; background: #3D9B46; color: white; border-radius: 50%; width: 20px; height: 20px; display: none; align-items: center; justify-content: center; font-size: 12px; }
    .image-grid-item.selected .checkmark { display: flex; }
    .add-btn { background: #E8960A; color: #fff; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-size: 13px; }
    .add-btn:hover { background: #D18800; }
    .inline-group { display: flex; gap: 12px; }
    .inline-group > div { flex: 1; }
    .output-buttons { display: flex; gap: 10px; margin-top: 20px; padding-top: 20px; border-top: 1px solid #e0e0e0; }
    .output-buttons button { flex: 1; padding: 12px; border: none; border-radius: 6px; font-size: 14px; cursor: pointer; font-weight: bold; }
    .copy-btn { background: #3D9B46; color: #fff; }
    .copy-btn:hover { background: #368D3F; }
    .download-btn { background: #2B87D1; color: #fff; }
    .download-btn:hover { background: #2578BA; }
    .copy-success { text-align: center; color: #3D9B46; font-weight: bold; margin-top: 10px; display: none; }
    .other-input { display: none; margin-top: -8px; margin-bottom: 12px; }
    .other-input.active { display: block; }
    .preview-mode-btn { background: #E8960A; color: #fff; border: none; padding: 5px 12px; border-radius: 4px; cursor: pointer; font-size: 12px; }
    .preview-mode-btn:hover { background: #D18800; }
    .image-item-wrapper { display: flex; align-items: flex-start; gap: 10px; }
    .image-thumbnail { width: 80px; height: 80px; object-fit: cover; border-radius: 6px; border: 1px solid #ddd; background: #f5f5f5; }
    .image-thumbnail-placeholder { width: 80px; height: 80px; border-radius: 6px; border: 1px dashed #ccc; background: #f9f9f9; display: flex; align-items: center; justify-content: center; font-size: 10px; color: #999; text-align: center; }
    .image-inputs { flex: 1; position: relative; }
    .move-buttons { display: flex; flex-direction: column; gap: 2px; }
    .move-btn { background: #e0e0e0; border: none; border-radius: 4px; width: 28px; height: 28px; cursor: pointer; font-size: 12px; display: flex; align-items: center; justify-content: center; }
    .move-btn:hover { background: #E8960A; color: #fff; }
    .dynamic-item.dragging { opacity: 0.5; border: 2px dashed #E8960A; }
    .dynamic-item.drag-over { border-top: 3px solid #E8960A; }
    .auto-generate-btn { background: #8B24A0; color: #fff; border: none; padding: 2px 8px; border-radius: 4px; font-size: 11px; cursor: pointer; margin-left: 8px; }
    .auto-generate-btn:hover { background: #6E1B90; }
    .caption-suggest-popup { position: absolute; top: 100%; left: 0; right: 0; background: #fff; border: 2px solid #8B24A0; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); z-index: 1000; max-height: 350px; overflow-y: auto; }
    .caption-suggest-header { display: flex; justify-content: space-between; align-items: center; padding: 10px 15px; background: #8B24A0; color: #fff; font-size: 13px; font-weight: bold; position: sticky; top: 0; }
    .caption-suggest-header button { background: none; border: none; color: #fff; cursor: pointer; font-size: 16px; padding: 0 5px; }
    .caption-suggest-list { max-height: 300px; overflow-y: auto; }
    .caption-suggest-item { padding: 12px 15px; border-bottom: 1px solid #eee; cursor: pointer; font-size: 13px; transition: background 0.2s; line-height: 1.5; }
    .caption-suggest-item:hover { background: #F0E0F3; }
    .caption-suggest-item.selected { background: #e0e0e0; color: #666; }
    .caption-suggest-item:last-child { border-bottom: none; }
    .load-tab-btn { flex: 1; padding: 10px 15px; border: 2px solid #E8960A; background: #fff; color: #E8960A; font-weight: bold; font-size: 12px; border-radius: 6px; cursor: pointer; transition: all 0.2s; }
    .load-tab-btn:hover { background: #FFF6DC; }
    .load-tab-btn.active { background: #E8960A; color: #fff; }
    .review-item { padding-right: 40px; }
    .banner-img-item { padding-right: 40px; }
    @media (max-width: 1024px) {
      .app-container { flex-direction: column; }
      .input-panel, .preview-panel { width: 100%; height: auto; min-height: 50vh; }
      .preview-panel { border-top: 2px solid #e0e0e0; }
    }
  </style>
</head>
<body>

<div class="app-container">
  <div class="input-panel">
    <h1>ğŸ¦› KABAG HTMLç”Ÿæˆã‚¢ãƒ—ãƒª</h1>
    
    <!-- HTMLã‚½ãƒ¼ã‚¹èª­ã¿è¾¼ã¿ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
    <div style="background: #FFF6DC; padding: 15px; border-radius: 8px; margin-bottom: 20px; border: 2px solid #E8960A;">
      <h2 style="margin-top: 0; border-left-color: #E8960A;">ğŸ“¥ ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿</h2>
      <div style="display: flex; gap: 10px; margin-bottom: 15px;">
        <button type="button" id="tabNewPage" class="load-tab-btn active" onclick="switchLoadTab('newPage')">æ—¢å­˜ãƒšãƒ¼ã‚¸ã‹ã‚‰æ–°è¦ä½œæˆ</button>
        <button type="button" id="tabEditHtml" class="load-tab-btn" onclick="switchLoadTab('editHtml')">ä½œæˆæ¸ˆã¿HTMLã‚’ç·¨é›†</button>
      </div>
      <div id="loadTabNewPage">
        <p style="font-size: 0.85em; color: #666; margin-bottom: 10px;">å•†å“ãƒšãƒ¼ã‚¸ã§ã€Œå³ã‚¯ãƒªãƒƒã‚¯ã€â†’ã€Œãƒšãƒ¼ã‚¸ã®ã‚½ãƒ¼ã‚¹ã‚’è¡¨ç¤ºã€â†’ å…¨é¸æŠã—ã¦ã‚³ãƒ”ãƒ¼ â†’ ä¸‹ã«è²¼ã‚Šä»˜ã‘</p>
        <textarea id="htmlSource" placeholder="HTMLã‚½ãƒ¼ã‚¹ã‚’ã“ã“ã«è²¼ã‚Šä»˜ã‘ã¦ãã ã•ã„..." style="width: 100%; height: 100px; font-size: 12px; font-family: monospace;"></textarea>
        <button type="button" class="add-btn" onclick="parseHTMLSource()" style="width: 100%; margin-top: 10px; padding: 12px; font-size: 14px;">ğŸ” è§£æã—ã¦èª­ã¿è¾¼ã‚€</button>
      </div>
      <div id="loadTabEditHtml" style="display: none;">
        <p style="font-size: 0.85em; color: #666; margin-bottom: 10px;">ã“ã®ã‚¢ãƒ—ãƒªã§ä½œæˆã—ãŸHTMLã‚’è²¼ã‚Šä»˜ã‘ã‚‹ã¨ã€ãƒ•ã‚©ãƒ¼ãƒ ã«åæ˜ ã•ã‚Œã¾ã™</p>
        <textarea id="editHtmlSource" placeholder="ä½œæˆæ¸ˆã¿ã®HTMLã‚³ãƒ¼ãƒ‰ã‚’ã“ã“ã«è²¼ã‚Šä»˜ã‘ã¦ãã ã•ã„..." style="width: 100%; height: 100px; font-size: 12px; font-family: monospace;"></textarea>
        <button type="button" class="add-btn" onclick="loadCreatedHTML()" style="width: 100%; margin-top: 10px; padding: 12px; font-size: 14px; background: #3D9B46;">ğŸ“‚ HTMLã‚’èª­ã¿è¾¼ã‚“ã§ç·¨é›†</button>
      </div>
      <div id="extractedImages" style="display: none; margin-top: 15px;">
        <p style="font-weight: bold; margin-bottom: 10px;">â–  æŠ½å‡ºã•ã‚ŒãŸç”»åƒï¼ˆã‚¯ãƒªãƒƒã‚¯ã§é¸æŠï¼‰</p>
        <div id="imageGrid" style="display: flex; flex-wrap: wrap; gap: 10px; max-height: 200px; overflow-y: auto;"></div>
        <div style="margin-top: 10px;">
          <button type="button" class="add-btn" onclick="applySelectedImages('detail')" style="margin-right: 5px;">å•†å“è©³ç´°ã«è¿½åŠ </button>
          <button type="button" class="add-btn" onclick="applySelectedImages('slider')" style="background: #2B87D1;">ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã«è¿½åŠ </button>
        </div>
      </div>
      <div id="extractedCaptionsDiv" style="display: none; margin-top: 15px;">
        <p style="font-weight: bold; margin-bottom: 10px;">â–  ã‚­ãƒ£ãƒ—ã‚·ãƒ§ãƒ³å€™è£œï¼ˆç”»åƒè¿½åŠ æ™‚ã«é¸æŠå¯èƒ½ï¼‰</p>
        <div id="captionsList" style="background: #fff; padding: 10px; border-radius: 6px; max-height: 120px; overflow-y: auto; font-size: 12px;"></div>
      </div>
      <div id="extractedPoints" style="display: none; margin-top: 15px;">
        <p style="font-weight: bold; margin-bottom: 10px;">â–  æ¤œå‡ºã•ã‚ŒãŸå•†å“ãƒã‚¤ãƒ³ãƒˆï¼ˆãƒã‚§ãƒƒã‚¯ã—ã¦åæ˜ ï¼‰</p>
        <div id="pointsList" style="background: #fff; padding: 10px; border-radius: 6px; max-height: 150px; overflow-y: auto;"></div>
        <button type="button" class="add-btn" onclick="applySelectedPoints()" style="width: 100%; margin-top: 10px;">ãƒã‚§ãƒƒã‚¯ã—ãŸé …ç›®ã‚’åæ˜ </button>
      </div>
    </div>
    
    <!-- åŸºæœ¬æƒ…å ± -->
    <h2>åŸºæœ¬æƒ…å ±</h2>
    <label>ã‚µãƒ–ã‚¿ã‚¤ãƒˆãƒ«ï¼ˆå°ã•ã„æ–‡å­—ï¼‰</label>
    <input type="text" id="productSubtitle" placeholder="ä¾‹ï¼šæœ¬ã‚’èª­ã‚€ã®ãŒæ„‰ã—ã¿ã«ãªã‚‹" oninput="updatePreview()">
    <label>ã‚«ãƒ†ã‚´ãƒªãƒ¼åï¼ˆä¸­ã‚µã‚¤ã‚ºï¼‰</label>
    <input type="text" id="productCategory" placeholder="ä¾‹ï¼šãƒ¬ã‚¶ãƒ¼ãƒ–ãƒƒã‚¯ã‚«ãƒãƒ¼" oninput="updatePreview()">
    <label>å•†å“åï¼ˆå¤§ãã„æ–‡å­—ï¼‰</label>
    <input type="text" id="productName" placeholder="ä¾‹ï¼šbunko" oninput="updatePreview()">
    <label>YouTubeå‹•ç”»URLï¼ˆä»»æ„ï¼‰</label>
    <input type="url" id="youtubeUrl" placeholder="ä¾‹ï¼šhttps://www.youtube.com/embed/XXXXX" oninput="extractYoutubeUrl(this); updatePreview()">
    <p style="font-size: 0.75em; color: #888; margin-top: -8px; margin-bottom: 12px;">â€»åŸ‹ã‚è¾¼ã¿ã‚³ãƒ¼ãƒ‰ã‚’è²¼ã‚Šä»˜ã‘ã¦ã‚‚URLã‚’è‡ªå‹•æŠ½å‡ºã—ã¾ã™</p>
    
    <!-- ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒãƒŠãƒ¼ -->
    <h2>â­ ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒãƒŠãƒ¼ï¼ˆYouTubeç›´ä¸‹ã«è¡¨ç¤ºï¼‰</h2>
    <p style="font-size: 0.8em; color: #888; margin-bottom: 10px;">â€»Judge.meã®ãƒ™ã‚¹ãƒˆãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’3ä»¶ã¾ã§å…¥åŠ›ã€‚ã‚¯ãƒªãƒƒã‚¯ã§ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆã«ã‚¸ãƒ£ãƒ³ãƒ—ã—ã¾ã™</p>
    
    <!-- Judge.me APIè¨­å®š -->
    <div style="background: #f0f8ff; padding: 15px; border-radius: 8px; margin-bottom: 15px; border: 1px solid #4A90A4;">
      <p style="font-weight: bold; font-size: 0.9em; margin: 0 0 10px; color: #4A90A4;">ğŸ”— Judge.me APIã‹ã‚‰ãƒ¬ãƒ“ãƒ¥ãƒ¼è‡ªå‹•å–å¾—</p>
      <label>Shop Domain</label>
      <input type="text" id="judgemeShopDomain" placeholder="ä¾‹ï¼škabag-jp.myshopify.com" style="margin-bottom: 8px;">
      <label>Public API Token</label>
      <input type="text" id="judgemeApiToken" placeholder="Judge.me Settings > Integrations ã§ç¢ºèª" style="margin-bottom: 8px;">
      <label>å•†å“URL or ãƒãƒ³ãƒ‰ãƒ«</label>
      <input type="text" id="judgemeProductHandle" placeholder="ä¾‹ï¼škabag-box-mini-2 ã¾ãŸã¯å•†å“ãƒšãƒ¼ã‚¸URL" style="margin-bottom: 8px;">
      <p style="font-size: 0.7em; color: #888; margin: -4px 0 10px;">â€»å•†å“URLã‚’è²¼ã‚Šä»˜ã‘ã‚‹ã¨ãƒãƒ³ãƒ‰ãƒ«ã‚’è‡ªå‹•æŠ½å‡ºã—ã¾ã™</p>
      <div style="display: flex; gap: 8px;">
        <button type="button" class="add-btn" onclick="fetchJudgemeReviews()" style="flex: 1; padding: 10px; font-size: 13px; background: #4A90A4;">â­ ãƒ™ã‚¹ãƒˆãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’å–å¾—</button>
        <button type="button" class="add-btn" onclick="saveJudgemeSettings()" style="flex: 0; padding: 10px; font-size: 12px; background: #888;">ğŸ’¾ è¨­å®šä¿å­˜</button>
      </div>
      <div id="judgemeStatus" style="display: none; margin-top: 10px; padding: 8px; border-radius: 6px; font-size: 12px;"></div>
    </div>
    <div class="dynamic-list" id="reviewBannerList">
      <div class="dynamic-item review-item">
        <button type="button" class="delete-btn" onclick="deleteItem(this)">Ã—</button>
        <div style="display: flex; gap: 8px; margin-bottom: 8px; align-items: center;">
          <span style="background: #E8960A; color: #fff; font-size: 10px; font-weight: bold; padding: 2px 8px; border-radius: 4px;">BEST REVIEW</span>
          <span style="color: #E8960A; font-size: 13px;">â˜…â˜…â˜…â˜…â˜…</span>
        </div>
        <label>ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚¿ã‚¤ãƒˆãƒ«</label>
        <input type="text" class="review-title" placeholder="ä¾‹ï¼šä½•åº¦ã‚‚ãƒªãƒ”ã—ã¦ã¾ã™" oninput="updatePreview()">
        <label>ãƒ¬ãƒ“ãƒ¥ãƒ¼æœ¬æ–‡</label>
        <textarea class="review-body" placeholder="ä¾‹ï¼šã¨ã«ã‹ãä½¿ã„ã‚„ã™ã„ã€‚ã¡ã‚‡ã£ã¨ãã‚‰ã„é›¨ã«æ¿¡ã‚Œã¦ã‚‚å¤§ä¸ˆå¤«ã§..." oninput="updatePreview()"></textarea>
        <label>å±æ€§ã‚¿ã‚°ï¼ˆä»»æ„ï¼‰</label>
        <input type="text" class="review-tags" placeholder="ä¾‹ï¼šå®Ÿç”¨å“ãƒ»æ™®æ®µä½¿ã„ï½œè‡ªåˆ†ç”¨ï½œãƒªãƒ”ãƒ¼ãƒˆ" oninput="updatePreview()">
        <label>ã‚­ãƒ£ãƒ—ã‚·ãƒ§ãƒ³ï¼ˆèµ¤å¸¯ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ï¼‰</label>
        <input type="text" class="review-caption" placeholder="ä¾‹ï¼šãƒªãƒ”ãƒ¼ãƒˆç¶šå‡ºï¼ã‚³ãƒ³ãƒ‘ã‚¯ãƒˆãªã®ã«å¤§å®¹é‡ã§ä½¿ã„ã‚„ã™ã„ãƒãƒƒã‚°" oninput="updatePreview()">
      </div>
    </div>
    <button type="button" class="add-btn" onclick="addReviewBannerItem()">+ ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’è¿½åŠ </button>
    
    <!-- ã‚¯ãƒ©ãƒ•ã‚¡ãƒ³å®Ÿç¸¾ãƒ»ãƒãƒŠãƒ¼ç”»åƒ -->
    <h2>ğŸ† ã‚¯ãƒ©ãƒ•ã‚¡ãƒ³å®Ÿç¸¾ãƒ»ãƒãƒŠãƒ¼ç”»åƒï¼ˆãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒãƒŠãƒ¼ä¸‹ã«è¡¨ç¤ºï¼‰</h2>
    <p style="font-size: 0.8em; color: #888; margin-bottom: 10px;">â€»Makuakeç­‰ã®ã‚¯ãƒ©ãƒ•ã‚¡ãƒ³å®Ÿç¸¾ç”»åƒã‚„ãƒ—ãƒ­ãƒ¢ãƒãƒŠãƒ¼ã‚’è¿½åŠ ã€‚è¤‡æ•°è¿½åŠ ãƒ»ä¸¦ã³æ›¿ãˆå¯èƒ½</p>
    <div class="dynamic-list" id="bannerImageList"></div>
    <button type="button" class="add-btn" onclick="addBannerImageItem()">+ ãƒãƒŠãƒ¼ç”»åƒã‚’è¿½åŠ </button>
    
    <!-- è³¼å…¥å‰ã«çŸ¥ã£ã¦ãŠããŸã„ã“ã¨ -->
    <h2>è³¼å…¥å‰ã«çŸ¥ã£ã¦ãŠããŸã„ã“ã¨</h2>
    <div class="checkbox-group" id="beforePurchaseCheckboxes">
      <label><input type="checkbox" value="17ã‚¤ãƒ³ãƒã®PC åç´OK" onchange="updatePreview()"> 17ã‚¤ãƒ³ãƒã®PC åç´OK</label>
      <label><input type="checkbox" value="15ã‚¤ãƒ³ãƒã®PC åç´OK" onchange="updatePreview()"> 15ã‚¤ãƒ³ãƒã®PC åç´OK</label>
      <label><input type="checkbox" value="13ã‚¤ãƒ³ãƒã®PC åç´OK" onchange="updatePreview()"> 13ã‚¤ãƒ³ãƒã®PC åç´OK</label>
      <label><input type="checkbox" value="A4ãƒ•ã‚¡ã‚¤ãƒ« åç´OK" onchange="updatePreview()"> A4ãƒ•ã‚¡ã‚¤ãƒ« åç´OK</label>
      <label><input type="checkbox" value="ãƒšãƒƒãƒˆãƒœãƒˆãƒ«åç´OK" onchange="updatePreview()"> ãƒšãƒƒãƒˆãƒœãƒˆãƒ«åç´OK</label>
      <label><input type="checkbox" value="30æ—¥é–“è¿”é‡‘ä¿è¨¼â€¼ï¸" checked onchange="updatePreview()"> 30æ—¥é–“è¿”é‡‘ä¿è¨¼â€¼ï¸</label>
      <label><input type="checkbox" value="å…¨å›½é€æ–™ç„¡æ–™â€¼ï¸" checked onchange="updatePreview()"> å…¨å›½é€æ–™ç„¡æ–™â€¼ï¸</label>
    </div>
    <div class="dynamic-list" id="beforePurchaseList">
      <p style="font-size: 0.85em; color: #666; margin: 0 0 8px 0;">ãã®ä»–ã®é …ç›®ï¼š</p>
    </div>
    <button type="button" class="add-btn" onclick="addBeforePurchaseItem()">+ é …ç›®ã‚’è¿½åŠ </button>
    
    <!-- ã‚ˆãã‚ã‚‹è³ªå• -->
    <h2>ã‚ˆãã‚ã‚‹è³ªå•</h2>
    <div class="dynamic-list" id="faqList">
      <div class="dynamic-item">
        <button type="button" class="delete-btn" onclick="deleteItem(this)">Ã—</button>
        <label>è³ªå•</label>
        <input type="text" class="faq-q" value="åç´ã§ãã‚‹ãƒ‘ã‚½ã‚³ãƒ³ã®ã‚µã‚¤ã‚ºã«ã¤ã„ã¦æ•™ãˆã¦ãã ã•ã„ã€‚" oninput="updatePreview()">
        <label>å›ç­”</label>
        <textarea class="faq-a" oninput="updatePreview()">15ã‚¤ãƒ³ãƒã¾ã§åç´å¯èƒ½ã§ã™ã€‚</textarea>
      </div>
      <div class="dynamic-item">
        <button type="button" class="delete-btn" onclick="deleteItem(this)">Ã—</button>
        <label>è³ªå•</label>
        <input type="text" class="faq-q" value="é›¨ã«æ¿¡ã‚Œã¦ã‚‚å¤§ä¸ˆå¤«ã§ã™ã‹ï¼Ÿ" oninput="updatePreview()">
        <label>å›ç­”</label>
        <textarea class="faq-a" oninput="updatePreview()">æ’¥æ°´åŠ å·¥ã®ç”Ÿåœ°ã‚’ä½¿ç”¨ã—ã¦ãŠã‚Šã€æ¿¡ã‚Œã«ãã„ç´ æã§ã™ã€‚</textarea>
      </div>
      <div class="dynamic-item">
        <button type="button" class="delete-btn" onclick="deleteItem(this)">Ã—</button>
        <label>è³ªå•</label>
        <input type="text" class="faq-q" value="æ´—æ¿¯ã¯ã§ãã¾ã™ã‹ï¼Ÿ" oninput="updatePreview()">
        <label>å›ç­”</label>
        <textarea class="faq-a" oninput="updatePreview()">æ´—æ¿¯ã¯ã§ãã¾ã›ã‚“ã€‚</textarea>
      </div>
    </div>
    <button type="button" class="add-btn" onclick="addFaqItem()">+ è³ªå•ã‚’è¿½åŠ </button>
    
    <!-- å•†å“è©³ç´°ç”»åƒ -->
    <h2>å•†å“è©³ç´°ï¼ˆç”»åƒï¼‹ã‚­ãƒ£ãƒ—ã‚·ãƒ§ãƒ³ï¼‰</h2>
    <p style="font-size: 0.8em; color: #888; margin-bottom: 10px;">â€»ãƒ‰ãƒ©ãƒƒã‚°ã¾ãŸã¯â–²â–¼ãƒœã‚¿ãƒ³ã§ä¸¦ã³æ›¿ãˆå¯èƒ½ / 1ç•ªç›®ã®ç”»åƒã¯ãƒ¡ã‚¤ãƒ³ãƒ“ã‚¸ãƒ¥ã‚¢ãƒ«ã«ãªã‚Šã¾ã™</p>
    <div class="dynamic-list" id="productDetailList">
      <div class="dynamic-item" draggable="true" ondragstart="dragStart(event)" ondragover="dragOver(event)" ondrop="drop(event, 'productDetailList')" ondragend="dragEnd(event)">
        <button type="button" class="delete-btn" onclick="deleteItem(this)">Ã—</button>
        <div class="image-item-wrapper">
          <div class="move-buttons">
            <button type="button" class="move-btn" onclick="moveItem(this, -1)">â–²</button>
            <button type="button" class="move-btn" onclick="moveItem(this, 1)">â–¼</button>
          </div>
          <div class="image-thumbnail-placeholder">ç”»åƒ<br>ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼</div>
          <div class="image-inputs">
            <label>ç”»åƒURL</label>
            <input type="url" class="detail-img" placeholder="https://cdn.shopify.com/..." oninput="updatePreview(); updateThumbnail(this, 'detail')">
            <label>ã‚­ãƒ£ãƒ—ã‚·ãƒ§ãƒ³ <button type="button" class="auto-generate-btn" onclick="generateCaption(this)">âœ¨ è‡ªå‹•ç”Ÿæˆ</button></label>
            <textarea class="detail-caption" placeholder="ä¾‹ï¼šã‚¹ãƒˆãƒ¬ãƒ¼ãƒˆã«ç´ æã‚’æ„Ÿã˜ã¦ã‚‚ã‚‰ãˆã‚‹ã‚·ãƒ³ãƒ—ãƒ«ãªãƒ‡ã‚¶ã‚¤ãƒ³ã€‚" oninput="updatePreview()"></textarea>
          </div>
        </div>
      </div>
    </div>
    <button type="button" class="add-btn" onclick="addDetailItem()">+ ç”»åƒã‚’è¿½åŠ </button>
    
    <!-- ã‚µã‚¤ã‚ºãƒ»ç´ æ -->
    <h2>ã‚µã‚¤ã‚ºãƒ»ç´ æ</h2>
    <p style="font-size: 0.8em; color: #888; margin-bottom: 10px;">â€»ç©ºæ¬„ã®é …ç›®ã¯è¡¨ç¤ºã•ã‚Œã¾ã›ã‚“</p>
    <div class="inline-group">
      <div><label>å®¹é‡</label><input type="text" id="capacity" placeholder="ä¾‹ï¼š11L" oninput="updatePreview()"></div>
      <div><label>é‡ã•</label><input type="text" id="weight" placeholder="ä¾‹ï¼š820g" oninput="updatePreview()"></div>
    </div>
    <label>ã‚µã‚¤ã‚º <button type="button" class="auto-generate-btn" onclick="generateSizeSuggest()">âœ¨ è‡ªå‹•ç”Ÿæˆ</button></label>
    <input type="text" id="size" placeholder="ä¾‹ï¼šé«˜ã•37cm Ã— æ¨ª28cm Ã— ãƒãƒ13cm" oninput="updatePreview()">
    <label>ç´ æï¼ˆæœ¬ä½“ï¼‰</label>
    <select id="materialMain" onchange="toggleMaterialOther('Main'); updatePreview()">
      <option value="">-- é¸æŠã—ã¦ãã ã•ã„ --</option>
      <option value="ãƒãƒªã‚¨ã‚¹ãƒ†ãƒ«">ãƒãƒªã‚¨ã‚¹ãƒ†ãƒ«</option>
      <option value="ãƒŠã‚¤ãƒ­ãƒ³">ãƒŠã‚¤ãƒ­ãƒ³</option>
      <option value="ãƒãƒªã‚¹ãƒ†ã‚£ãƒƒã‚¯ãƒŠã‚¤ãƒ­ãƒ³">ãƒãƒªã‚¹ãƒ†ã‚£ãƒƒã‚¯ãƒŠã‚¤ãƒ­ãƒ³</option>
      <option value="ãƒãƒ³ãƒ—">ãƒãƒ³ãƒ—</option>
      <option value="ç‰›é©">ç‰›é©</option>
      <option value="other">ãã®ä»–ï¼ˆç›´æ¥å…¥åŠ›ï¼‰</option>
    </select>
    <div class="other-input" id="otherMaterialMain"><input type="text" id="materialMainOther" placeholder="ç´ æã‚’å…¥åŠ›" oninput="updatePreview()"></div>
    <label>ç´ æï¼ˆè£åœ°ï¼‰</label>
    <select id="materialLining" onchange="toggleMaterialOther('Lining'); updatePreview()">
      <option value="">-- é¸æŠã—ã¦ãã ã•ã„ --</option>
      <option value="ãƒãƒªã‚¨ã‚¹ãƒ†ãƒ«">ãƒãƒªã‚¨ã‚¹ãƒ†ãƒ«</option>
      <option value="ãƒŠã‚¤ãƒ­ãƒ³">ãƒŠã‚¤ãƒ­ãƒ³</option>
      <option value="ãƒªãƒƒãƒ—ã‚¹ãƒˆãƒƒãƒ—ãƒŠã‚¤ãƒ­ãƒ³">ãƒªãƒƒãƒ—ã‚¹ãƒˆãƒƒãƒ—ãƒŠã‚¤ãƒ­ãƒ³</option>
      <option value="ãƒãƒ³ãƒ—">ãƒãƒ³ãƒ—</option>
      <option value="other">ãã®ä»–ï¼ˆç›´æ¥å…¥åŠ›ï¼‰</option>
    </select>
    <div class="other-input" id="otherMaterialLining"><input type="text" id="materialLiningOther" placeholder="ç´ æã‚’å…¥åŠ›" oninput="updatePreview()"></div>
    <label>ã‚«ãƒ©ãƒ¼ <button type="button" class="auto-generate-btn" onclick="generateColorSuggest()">âœ¨ è‡ªå‹•ç”Ÿæˆ</button></label>
    <p style="font-size: 0.75em; color: #888; margin-top: -8px; margin-bottom: 8px;">â€»è‰²ã”ã¨ã«1è¡Œãšã¤å…¥åŠ›ã—ã¦ãã ã•ã„</p>
    <div class="dynamic-list" id="colorList">
      <div class="dynamic-item color-item">
        <button type="button" class="delete-btn" onclick="deleteItem(this)">Ã—</button>
        <input type="text" class="color-input" placeholder="ä¾‹ï¼šãƒ–ãƒ©ãƒƒã‚¯ï¼ˆå†…è£…ã‚ªãƒ¬ãƒ³ã‚¸ï¼‰" oninput="updatePreview()">
      </div>
    </div>
    <button type="button" class="add-btn" onclick="addColorItem()">+ ã‚«ãƒ©ãƒ¼ã‚’è¿½åŠ </button>
    <label style="margin-top: 15px;">ç”Ÿç”£åœ°</label>
    <select id="productionPlace" onchange="toggleOtherInput(); updatePreview()">
      <option value="">-- é¸æŠã—ã¦ãã ã•ã„ --</option>
      <option value="ä¸­å›½">ä¸­å›½</option>
      <option value="ã‚«ãƒ³ãƒœã‚¸ã‚¢">ã‚«ãƒ³ãƒœã‚¸ã‚¢</option>
      <option value="æ—¥æœ¬">æ—¥æœ¬</option>
      <option value="other">ãã®ä»–ï¼ˆç›´æ¥å…¥åŠ›ï¼‰</option>
    </select>
    <div class="other-input" id="otherProductionPlace"><input type="text" id="productionPlaceOther" placeholder="ç”Ÿç”£åœ°ã‚’å…¥åŠ›" oninput="updatePreview()"></div>
    <label style="margin-top: 15px;">ãã®ä»–ã®é …ç›®</label>
    <p style="font-size: 0.75em; color: #888; margin-top: -8px; margin-bottom: 8px;">â€»è‡ªç”±ã«é …ç›®ã‚’è¿½åŠ ã§ãã¾ã™</p>
    <div class="dynamic-list" id="specOtherList"></div>
    <button type="button" class="add-btn" onclick="addSpecOtherItem()">+ é …ç›®ã‚’è¿½åŠ </button>
    
    <!-- ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ç”»åƒ -->
    <h2>ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ç”»åƒ</h2>
    <p style="font-size: 0.8em; color: #888; margin-bottom: 10px;">â€»ãƒ‰ãƒ©ãƒƒã‚°ã¾ãŸã¯â–²â–¼ãƒœã‚¿ãƒ³ã§ä¸¦ã³æ›¿ãˆå¯èƒ½</p>
    <div class="dynamic-list" id="sliderList">
      <div class="dynamic-item" draggable="true" ondragstart="dragStart(event)" ondragover="dragOver(event)" ondrop="drop(event, 'sliderList')" ondragend="dragEnd(event)">
        <button type="button" class="delete-btn" onclick="deleteItem(this)">Ã—</button>
        <div class="image-item-wrapper">
          <div class="move-buttons">
            <button type="button" class="move-btn" onclick="moveItem(this, -1)">â–²</button>
            <button type="button" class="move-btn" onclick="moveItem(this, 1)">â–¼</button>
          </div>
          <div class="image-thumbnail-placeholder">ç”»åƒ<br>ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼</div>
          <div class="image-inputs">
            <label>ç”»åƒURL</label>
            <input type="url" class="slider-img" placeholder="https://cdn.shopify.com/..." oninput="updatePreview(); updateThumbnail(this, 'slider')">
            <label>ã‚­ãƒ£ãƒ—ã‚·ãƒ§ãƒ³ <button type="button" class="auto-generate-btn" onclick="generateCaption(this)">âœ¨ è‡ªå‹•ç”Ÿæˆ</button></label>
            <input type="text" class="slider-caption" placeholder="ä¾‹ï¼šå¹…åºƒã„ã‚µã‚¤ã‚ºå±•é–‹" oninput="updatePreview()">
          </div>
        </div>
      </div>
    </div>
    <button type="button" class="add-btn" onclick="addSliderItem()">+ ç”»åƒã‚’è¿½åŠ </button>
    
    <!-- å‡ºåŠ›ãƒœã‚¿ãƒ³ -->
    <div class="output-buttons">
      <button type="button" class="copy-btn" onclick="copyToClipboard()">ğŸ“‹ HTMLã‚’ã‚³ãƒ”ãƒ¼</button>
      <button type="button" class="download-btn" onclick="downloadHTML()">ğŸ’¾ ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰</button>
    </div>
    <p class="copy-success" id="copySuccess">âœ“ ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼</p>
  </div>
  
  <!-- å³å´ï¼šãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒ‘ãƒãƒ« -->
  <div class="preview-panel">
    <div class="preview-header">
      <span>ğŸ“± ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼</span>
      <button class="preview-mode-btn" onclick="togglePreviewMode()">ã‚³ãƒ¼ãƒ‰è¡¨ç¤º</button>
    </div>
    <iframe id="previewIframe" class="preview-iframe"></iframe>
    <textarea id="codePreview" style="display:none; width:100%; height:calc(100vh - 50px); font-family:monospace; font-size:11px; padding:15px; border:none; background:#1e1e1e; color:#d4d4d4;"></textarea>
  </div>
</div>

<script>
let previewMode = 'visual';
let extractedCaptions = [];
let extractedColors = [];
let extractedSizes = [];

// ===== ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒãƒŠãƒ¼ =====
function addReviewBannerItem() {
  const list = document.getElementById('reviewBannerList');
  const count = list.querySelectorAll('.review-item').length;
  if (count >= 3) { alert('ãƒ¬ãƒ“ãƒ¥ãƒ¼ã¯æœ€å¤§3ä»¶ã¾ã§ã§ã™'); return; }
  const item = document.createElement('div');
  item.className = 'dynamic-item review-item';
  item.innerHTML = `<button type="button" class="delete-btn" onclick="deleteItem(this)">Ã—</button>
    <div style="display: flex; gap: 8px; margin-bottom: 8px; align-items: center;">
      <span style="color: #E8960A; font-size: 13px;">â˜…â˜…â˜…â˜…â˜…</span>
    </div>
    <label>ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚¿ã‚¤ãƒˆãƒ«</label>
    <input type="text" class="review-title" placeholder="ä¾‹ï¼šã—ã£ã‹ã‚Šã—ãŸä½œã‚Š" oninput="updatePreview()">
    <label>ãƒ¬ãƒ“ãƒ¥ãƒ¼æœ¬æ–‡</label>
    <textarea class="review-body" placeholder="ä¾‹ï¼šãŠå€¤æ®µã®å‰²ã«ã€ã¨ã¦ã‚‚ã—ã£ã‹ã‚Šã—ãŸä½œã‚Šã§ã™..." oninput="updatePreview()"></textarea>
    <label>å±æ€§ã‚¿ã‚°ï¼ˆä»»æ„ï¼‰</label>
    <input type="text" class="review-tags" placeholder="ä¾‹ï¼šå®Ÿç”¨å“ãƒ»æ™®æ®µä½¿ã„ï½œè‡ªåˆ†ç”¨ï½œã¯ã˜ã‚ã¦" oninput="updatePreview()">
    <label>ã‚­ãƒ£ãƒ—ã‚·ãƒ§ãƒ³ï¼ˆé’å¸¯ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ï¼‰</label>
    <input type="text" class="review-caption" placeholder="ä¾‹ï¼šãŠå€¤æ®µä»¥ä¸Šï¼ã—ã£ã‹ã‚Šã—ãŸä½œã‚Šã§ãŸã£ã·ã‚Šåç´åŠ›" oninput="updatePreview()">`;
  list.appendChild(item);
  updatePreview();
}

// ===== ãƒãƒŠãƒ¼ç”»åƒ =====
function addBannerImageItem() {
  const list = document.getElementById('bannerImageList');
  const item = document.createElement('div');
  item.className = 'dynamic-item banner-img-item';
  item.draggable = true;
  item.ondragstart = dragStart;
  item.ondragover = dragOver;
  item.ondrop = function(e) { drop(e, 'bannerImageList'); };
  item.ondragend = dragEnd;
  item.innerHTML = `<button type="button" class="delete-btn" onclick="deleteItem(this)">Ã—</button>
    <div class="image-item-wrapper">
      <div class="move-buttons">
        <button type="button" class="move-btn" onclick="moveItem(this, -1)">â–²</button>
        <button type="button" class="move-btn" onclick="moveItem(this, 1)">â–¼</button>
      </div>
      <div class="image-thumbnail-placeholder">ç”»åƒ<br>ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼</div>
      <div class="image-inputs">
        <label>ç”»åƒURL</label>
        <input type="url" class="banner-img-url" placeholder="https://cdn.shopify.com/..." oninput="updatePreview(); updateThumbnail(this, 'banner')">
        <label>ãƒªãƒ³ã‚¯å…ˆURLï¼ˆä»»æ„ï¼‰</label>
        <input type="url" class="banner-img-link" placeholder="ä¾‹ï¼šhttps://kabag.jp/pages/..." oninput="updatePreview()">
      </div>
    </div>`;
  list.appendChild(item);
  updatePreview();
}

// ===== ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆ =====
function switchLoadTab(tab) {
  document.getElementById('loadTabNewPage').style.display = tab === 'newPage' ? 'block' : 'none';
  document.getElementById('loadTabEditHtml').style.display = tab === 'editHtml' ? 'block' : 'none';
  document.getElementById('tabNewPage').classList.toggle('active', tab === 'newPage');
  document.getElementById('tabEditHtml').classList.toggle('active', tab === 'editHtml');
}

// ===== å…±é€šãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ =====
function deleteItem(btn) {
  const item = btn.closest('.dynamic-item');
  if (item) { const imgInput = item.querySelector('.detail-img, .slider-img'); if (imgInput && imgInput.value) releaseImageFromUsed(imgInput.value); item.remove(); updatePreview(); }
}
function releaseImageFromUsed(url) {
  const imageGrid = document.getElementById('imageGrid');
  if (!imageGrid) return;
  imageGrid.querySelectorAll('.image-grid-item').forEach(item => {
    const itemUrl = item.getAttribute('data-url');
    if (url.split('?')[0] === (itemUrl || '').split('?')[0]) item.classList.remove('used');
  });
}
function toggleOtherInput() {
  const select = document.getElementById('productionPlace');
  document.getElementById('otherProductionPlace').classList.toggle('active', select.value === 'other');
}
function toggleMaterialOther(type) {
  const select = document.getElementById('material' + type);
  document.getElementById('otherMaterial' + type).classList.toggle('active', select.value === 'other');
}
function addBeforePurchaseItem() {
  const list = document.getElementById('beforePurchaseList');
  const item = document.createElement('div');
  item.className = 'dynamic-item';
  item.innerHTML = `<button type="button" class="delete-btn" onclick="deleteItem(this)">Ã—</button><label>é …ç›®</label><input type="text" class="before-purchase-other" placeholder="ä¾‹ï¼šæŠ˜ã‚ŠãŸãŸã¿å‚˜åç´OK" oninput="updatePreview()">`;
  list.appendChild(item);
  updatePreview();
}
function addFaqItem() {
  const list = document.getElementById('faqList');
  const item = document.createElement('div');
  item.className = 'dynamic-item';
  item.innerHTML = `<button type="button" class="delete-btn" onclick="deleteItem(this)">Ã—</button><label>è³ªå•</label><input type="text" class="faq-q" placeholder="è³ªå•ã‚’å…¥åŠ›" oninput="updatePreview()"><label>å›ç­”</label><textarea class="faq-a" placeholder="å›ç­”ã‚’å…¥åŠ›" oninput="updatePreview()"></textarea>`;
  list.appendChild(item);
  updatePreview();
}
function addDetailItem() {
  const list = document.getElementById('productDetailList');
  const item = document.createElement('div');
  item.className = 'dynamic-item';
  item.draggable = true; item.ondragstart = dragStart; item.ondragover = dragOver; item.ondrop = function(e) { drop(e, 'productDetailList'); }; item.ondragend = dragEnd;
  item.innerHTML = `<button type="button" class="delete-btn" onclick="deleteItem(this)">Ã—</button><div class="image-item-wrapper"><div class="move-buttons"><button type="button" class="move-btn" onclick="moveItem(this, -1)">â–²</button><button type="button" class="move-btn" onclick="moveItem(this, 1)">â–¼</button></div><div class="image-thumbnail-placeholder">ç”»åƒ<br>ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼</div><div class="image-inputs"><label>ç”»åƒURL</label><input type="url" class="detail-img" placeholder="https://cdn.shopify.com/..." oninput="updatePreview(); updateThumbnail(this, 'detail')"><label>ã‚­ãƒ£ãƒ—ã‚·ãƒ§ãƒ³ <button type="button" class="auto-generate-btn" onclick="generateCaption(this)">âœ¨ è‡ªå‹•ç”Ÿæˆ</button></label><textarea class="detail-caption" placeholder="ä¾‹ï¼šã‚¹ãƒˆãƒ¬ãƒ¼ãƒˆã«ç´ æã‚’æ„Ÿã˜ã¦ã‚‚ã‚‰ãˆã‚‹ã‚·ãƒ³ãƒ—ãƒ«ãªãƒ‡ã‚¶ã‚¤ãƒ³ã€‚" oninput="updatePreview()"></textarea></div></div>`;
  list.appendChild(item);
  updatePreview();
}
function addSliderItem() {
  const list = document.getElementById('sliderList');
  const item = document.createElement('div');
  item.className = 'dynamic-item';
  item.draggable = true; item.ondragstart = dragStart; item.ondragover = dragOver; item.ondrop = function(e) { drop(e, 'sliderList'); }; item.ondragend = dragEnd;
  item.innerHTML = `<button type="button" class="delete-btn" onclick="deleteItem(this)">Ã—</button><div class="image-item-wrapper"><div class="move-buttons"><button type="button" class="move-btn" onclick="moveItem(this, -1)">â–²</button><button type="button" class="move-btn" onclick="moveItem(this, 1)">â–¼</button></div><div class="image-thumbnail-placeholder">ç”»åƒ<br>ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼</div><div class="image-inputs"><label>ç”»åƒURL</label><input type="url" class="slider-img" placeholder="https://cdn.shopify.com/..." oninput="updatePreview(); updateThumbnail(this, 'slider')"><label>ã‚­ãƒ£ãƒ—ã‚·ãƒ§ãƒ³ <button type="button" class="auto-generate-btn" onclick="generateCaption(this)">âœ¨ è‡ªå‹•ç”Ÿæˆ</button></label><input type="text" class="slider-caption" placeholder="ä¾‹ï¼šå¹…åºƒã„ã‚µã‚¤ã‚ºå±•é–‹" oninput="updatePreview()"></div></div>`;
  list.appendChild(item);
  updatePreview();
}
function addColorItem() {
  const list = document.getElementById('colorList');
  const item = document.createElement('div');
  item.className = 'dynamic-item color-item';
  item.innerHTML = `<button type="button" class="delete-btn" onclick="deleteItem(this)">Ã—</button><input type="text" class="color-input" placeholder="ä¾‹ï¼šãƒã‚¤ãƒ“ãƒ¼ï¼ˆå†…è£…ãƒ©ã‚¤ãƒˆãƒ–ãƒ«ãƒ¼ï¼‰" oninput="updatePreview()">`;
  list.appendChild(item);
  updatePreview();
}
function addSpecOtherItem() {
  const list = document.getElementById('specOtherList');
  const item = document.createElement('div');
  item.className = 'dynamic-item spec-other-item';
  item.innerHTML = `<button type="button" class="delete-btn" onclick="deleteItem(this)">Ã—</button><div class="spec-other-inputs"><input type="text" class="spec-other-label" placeholder="é …ç›®åï¼ˆä¾‹ï¼šãƒã‚±ãƒƒãƒˆæ•°ï¼‰" oninput="updatePreview()"><input type="text" class="spec-other-value" placeholder="å€¤ï¼ˆä¾‹ï¼š5ã¤ï¼‰" oninput="updatePreview()"></div>`;
  list.appendChild(item);
  updatePreview();
}
function addBeforePurchaseItemWithValue(value) {
  const list = document.getElementById('beforePurchaseList');
  const item = document.createElement('div');
  item.className = 'dynamic-item';
  item.innerHTML = `<button type="button" class="delete-btn" onclick="deleteItem(this)">Ã—</button><label>é …ç›®</label><input type="text" class="before-purchase-other" value="${value}" oninput="updatePreview()">`;
  list.appendChild(item);
}

// ===== ã‚­ãƒ£ãƒ—ã‚·ãƒ§ãƒ³è‡ªå‹•ç”Ÿæˆ =====
function generateCaption(btn) {
  const inputWrapper = btn.closest('.image-inputs');
  const captionInput = inputWrapper.querySelector('.detail-caption, .slider-caption');
  if (extractedCaptions.length === 0) { alert('ã‚­ãƒ£ãƒ—ã‚·ãƒ§ãƒ³å€™è£œãŒã‚ã‚Šã¾ã›ã‚“ã€‚'); return; }
  const existingPopup = document.querySelector('.caption-suggest-popup');
  if (existingPopup) existingPopup.remove();
  const popup = document.createElement('div');
  popup.className = 'caption-suggest-popup';
  popup.innerHTML = `<div class="caption-suggest-header"><span>ğŸ“ ã‚­ãƒ£ãƒ—ã‚·ãƒ§ãƒ³å€™è£œ</span><button type="button" onclick="this.closest('.caption-suggest-popup').remove()">âœ•</button></div><div class="caption-suggest-list">${extractedCaptions.map(c => `<div class="caption-suggest-item" onclick="selectCaption(this, '${c.replace(/'/g, "\\'")}')">${c}</div>`).join('')}</div>`;
  inputWrapper.appendChild(popup);
}
function selectCaption(item, caption) {
  const popup = item.closest('.caption-suggest-popup');
  const inputWrapper = popup.closest('.image-inputs');
  const captionInput = inputWrapper.querySelector('.detail-caption, .slider-caption');
  captionInput.value = caption;
  popup.remove();
  updatePreview();
}
function generateColorSuggest() {
  if (extractedColors.length === 0) { alert('ã‚«ãƒ©ãƒ¼å€™è£œãŒã‚ã‚Šã¾ã›ã‚“ã€‚'); return; }
  const existingPopup = document.querySelector('.color-suggest-popup');
  if (existingPopup) existingPopup.remove();
  const colorList = document.getElementById('colorList');
  const popup = document.createElement('div');
  popup.className = 'caption-suggest-popup color-suggest-popup';
  popup.innerHTML = `<div class="caption-suggest-header"><span>ğŸ¨ ã‚«ãƒ©ãƒ¼å€™è£œ</span><button type="button" onclick="this.closest('.color-suggest-popup').remove()">âœ•</button></div><div class="caption-suggest-list">${extractedColors.map(c => `<div class="caption-suggest-item" onclick="addColorFromSuggest('${c.replace(/'/g, "\\'")}')">${c}</div>`).join('')}</div>`;
  colorList.parentElement.insertBefore(popup, colorList.nextSibling);
}
function addColorFromSuggest(color) {
  const list = document.getElementById('colorList');
  const item = document.createElement('div');
  item.className = 'dynamic-item color-item';
  item.innerHTML = `<button type="button" class="delete-btn" onclick="deleteItem(this)">Ã—</button><input type="text" class="color-input" value="${color}" oninput="updatePreview()">`;
  list.appendChild(item);
  updatePreview();
}
function generateSizeSuggest() {
  if (extractedSizes.length === 0) { alert('ã‚µã‚¤ã‚ºå€™è£œãŒã‚ã‚Šã¾ã›ã‚“ã€‚'); return; }
  const sizeInput = document.getElementById('size');
  const existingPopup = document.querySelector('.size-suggest-popup');
  if (existingPopup) existingPopup.remove();
  const popup = document.createElement('div');
  popup.className = 'caption-suggest-popup size-suggest-popup';
  popup.style.position = 'absolute'; popup.style.width = '100%';
  popup.innerHTML = `<div class="caption-suggest-header"><span>ğŸ“ ã‚µã‚¤ã‚ºå€™è£œ</span><button type="button" onclick="this.closest('.size-suggest-popup').remove()">âœ•</button></div><div class="caption-suggest-list">${extractedSizes.map(s => `<div class="caption-suggest-item" onclick="selectSize('${s.replace(/'/g, "\\'")}')">${s}</div>`).join('')}</div>`;
  sizeInput.parentElement.style.position = 'relative';
  sizeInput.parentElement.appendChild(popup);
}
function selectSize(size) { document.getElementById('size').value = size; const popup = document.querySelector('.size-suggest-popup'); if (popup) popup.remove(); updatePreview(); }

// ===== ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ =====
function togglePreviewMode() {
  const iframe = document.getElementById('previewIframe');
  const codeArea = document.getElementById('codePreview');
  const btn = document.querySelector('.preview-mode-btn');
  if (previewMode === 'visual') { previewMode = 'code'; iframe.style.display = 'none'; codeArea.style.display = 'block'; btn.textContent = 'ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼è¡¨ç¤º'; codeArea.value = generateHTMLCode(); }
  else { previewMode = 'visual'; iframe.style.display = 'block'; codeArea.style.display = 'none'; btn.textContent = 'ã‚³ãƒ¼ãƒ‰è¡¨ç¤º'; }
}

// ===== HTMLç”Ÿæˆ =====
function generateHTMLCode() {
  const productSubtitle = document.getElementById('productSubtitle').value || '';
  const productCategory = document.getElementById('productCategory').value || '';
  const productName = document.getElementById('productName').value || 'å•†å“å';
  const youtubeUrl = document.getElementById('youtubeUrl').value;

  // ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒãƒŠãƒ¼
  const reviewItems = [];
  document.querySelectorAll('#reviewBannerList .review-item').forEach((item, idx) => {
    const title = item.querySelector('.review-title').value;
    const body = item.querySelector('.review-body').value;
    const tags = item.querySelector('.review-tags').value;
    const caption = item.querySelector('.review-caption').value;
    if (title || body) reviewItems.push({ title, body, tags, caption, isFirst: idx === 0 });
  });

  // ãƒãƒŠãƒ¼ç”»åƒ
  const bannerImages = [];
  document.querySelectorAll('#bannerImageList .banner-img-item').forEach(item => {
    const url = item.querySelector('.banner-img-url').value;
    const link = item.querySelector('.banner-img-link').value;
    if (url) bannerImages.push({ url, link });
  });

  const checkboxes = document.querySelectorAll('#beforePurchaseCheckboxes input[type="checkbox"]:checked');
  let beforePurchaseItems = Array.from(checkboxes).map(cb => cb.value);
  document.querySelectorAll('.before-purchase-other').forEach(item => { if (item.value.trim()) beforePurchaseItems.push(item.value.trim()); });
  const faqItems = [];
  document.querySelectorAll('#faqList .dynamic-item').forEach(item => { const q = item.querySelector('.faq-q').value; const a = item.querySelector('.faq-a').value; if (q && a) faqItems.push({ q, a }); });
  const detailItems = [];
  document.querySelectorAll('#productDetailList .dynamic-item').forEach(item => { const img = item.querySelector('.detail-img').value; const caption = item.querySelector('.detail-caption')?.value || ''; if (img) detailItems.push({ img, caption }); });
  const capacity = document.getElementById('capacity').value;
  const weight = document.getElementById('weight').value;
  const size = document.getElementById('size').value;
  const materialMainSelect = document.getElementById('materialMain').value;
  const materialMain = materialMainSelect === 'other' ? document.getElementById('materialMainOther').value : materialMainSelect;
  const materialLiningSelect = document.getElementById('materialLining').value;
  const materialLining = materialLiningSelect === 'other' ? document.getElementById('materialLiningOther').value : materialLiningSelect;
  const colorItems = [];
  document.querySelectorAll('#colorList .color-input').forEach(input => { if (input.value.trim()) colorItems.push(input.value.trim()); });
  const productionPlaceSelect = document.getElementById('productionPlace').value;
  const productionPlace = productionPlaceSelect === 'other' ? document.getElementById('productionPlaceOther').value : productionPlaceSelect;
  const specOtherItems = [];
  document.querySelectorAll('#specOtherList .spec-other-item').forEach(item => { const l = item.querySelector('.spec-other-label').value.trim(); const v = item.querySelector('.spec-other-value').value.trim(); if (l && v) specOtherItems.push({ label: l, value: v }); });
  const sliderItems = [];
  document.querySelectorAll('#sliderList .dynamic-item').forEach(item => { const img = item.querySelector('.slider-img').value; const caption = item.querySelector('.slider-caption')?.value || ''; if (img) sliderItems.push({ img, caption }); });

  let html = `<!-- ============================================
     ${productName} å•†å“ãƒšãƒ¼ã‚¸
     CSSã®ã¿ã§ã‚¿ãƒ–/ã‚¢ã‚³ãƒ¼ãƒ‡ã‚£ã‚ªãƒ³æ©Ÿèƒ½ã‚’å®Ÿç¾
     ï¼ˆJavaScriptä¸è¦ãƒ»Shopifyå•†å“èª¬æ˜æ¬„ç”¨ï¼‰
     ============================================ -->

<style>
/* ========== ã‚¢ã‚³ãƒ¼ãƒ‡ã‚£ã‚ªãƒ³ ========== */
.kabag-accordion { border: 1px solid #e0e0e0; margin-bottom: -1px; }
.kabag-accordion input[type="checkbox"] { display: none; }
.kabag-accordion-label { display: flex; justify-content: space-between; align-items: center; padding: 16px 20px; background: #fff; cursor: pointer; font-weight: bold; font-size: 14px; color: #333; }
.kabag-accordion-label:hover { background: #f9f9f9; }
.kabag-accordion-label::after { content: "â–¼"; font-size: 12px; transition: transform 0.3s; }
.kabag-accordion input[type="checkbox"]:checked + .kabag-accordion-label::after { transform: rotate(180deg); }
.kabag-accordion-content { max-height: 0; overflow: hidden; transition: max-height 0.3s ease; background: #fafafa; font-size: 14px; line-height: 1.8; color: #555; }
.kabag-accordion input[type="checkbox"]:checked ~ .kabag-accordion-content { max-height: 1000px; padding: 20px; border-top: 1px solid #e0e0e0; }
/* ========== æ¨ªã‚¿ãƒ– ========== */
.kabag-tabs-wrapper { margin-top: 30px; }
.kabag-tabs-wrapper input[type="radio"] { display: none; }
.kabag-tabs-nav { display: flex !important; flex-direction: row !important; flex-wrap: nowrap !important; align-items: stretch !important; justify-content: stretch !important; border-bottom: 2px solid #e0e0e0; width: 100%; margin: 0 !important; padding: 0 !important; }
.kabag-tabs-nav label { flex: 1 1 0 !important; display: flex !important; align-items: center !important; justify-content: center !important; text-align: center !important; padding: 14px 8px !important; margin: 0 !important; cursor: pointer; font-weight: bold; font-size: 14px; color: #888; border: none !important; border-bottom: 2px solid transparent !important; margin-bottom: -2px !important; transition: all 0.3s; min-height: 50px !important; box-sizing: border-box !important; line-height: 1.3 !important; background: transparent !important; }
.kabag-tabs-nav label:hover { color: #333; }
#kabag-tab1:checked ~ .kabag-tabs-nav label[for="kabag-tab1"],
#kabag-tab2:checked ~ .kabag-tabs-nav label[for="kabag-tab2"] { color: #333; border-bottom: 2px solid #E8960A !important; }
.kabag-tab-content { display: none; padding: 30px 0; }
#kabag-tab1:checked ~ .kabag-tab-content.tab1-content,
#kabag-tab2:checked ~ .kabag-tab-content.tab2-content { display: block; }
/* ========== ç”»åƒã‚»ã‚¯ã‚·ãƒ§ãƒ³ ========== */
.kabag-image-section { text-align: center; margin-bottom: 40px; }
.kabag-image-section img { max-width: 100%; }
.kabag-image-section p { font-size: 1.1em; margin-top: 16px; color: #333; }
/* ========== ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ ========== */
.kabag-slider { margin-top: 40px; position: relative; }
.kabag-slider-title { text-align: center; font-size: 1.2em; font-weight: bold; margin-bottom: 20px; color: #333; }
.kabag-slider-wrapper { position: relative; }
.kabag-slider-arrow { position: absolute; top: 50%; transform: translateY(-50%); width: 36px; height: 36px; background: rgba(0,0,0,0.45); color: #fff; border-radius: 50%; font-size: 1.2em; font-weight: bold; z-index: 10; pointer-events: none; display: flex; align-items: center; justify-content: center; line-height: 1; }
.kabag-slider-arrow-left { left: 8px; }
.kabag-slider-arrow-right { right: 8px; }
.kabag-slider-container { display: flex; overflow-x: auto; scroll-snap-type: x mandatory; -webkit-overflow-scrolling: touch; scrollbar-width: none; gap: 0; padding: 0 24px; }
.kabag-slider-container::-webkit-scrollbar { display: none; }
.kabag-slider-item { flex: 0 0 88%; scroll-snap-align: center; overflow: hidden; display: flex; flex-direction: column; box-sizing: border-box; margin: 0 6px; border-radius: 8px; border: 1px solid #e0e0e0; }
.kabag-slider-item img { width: 100%; aspect-ratio: 16 / 9; object-fit: contain; object-position: center; display: block; background: #fff; }
.kabag-slider-caption { text-align: center; padding: 12px 10px; font-size: 0.95em; color: #333; background: #fff; min-height: 80px; display: flex; align-items: center; justify-content: center; }
/* ========== ãƒ¡ã‚¤ãƒ³ãƒ“ã‚¸ãƒ¥ã‚¢ãƒ« ========== */
.kabag-main-visual { margin-bottom: 50px; }
.kabag-title-block { margin-top: 20px; }
.kabag-subtitle { font-size: 0.9em; color: #666; margin: 0 0 8px 0; }
.kabag-category { font-size: 1.3em; font-weight: bold; color: #333; margin: 0 0 4px 0; }
.kabag-product-name { font-size: 1.8em; font-weight: bold; color: #333; margin: 0; }
/* ========== ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒãƒŠãƒ¼ ========== */
.kabag-review-banner { padding: 30px 0 20px; border-bottom: 2px solid #E8960A; }
.kabag-review-banner a { text-decoration: none; color: inherit; display: block; }
.kabag-review-card { background: #fff; border: 1px solid #e0e0e0; border-radius: 10px; padding: 18px; margin-bottom: 14px; position: relative; }
.kabag-review-card:last-child { margin-bottom: 0; }
.kabag-review-caption { color: #fff; padding: 8px 14px; border-radius: 6px; margin-top: 12px; font-size: 12px; font-weight: bold; text-align: center; line-height: 1.5; }
</style>

`;

  // YouTube
  if (youtubeUrl) {
    html += `<!-- YouTubeå‹•ç”» -->
<div style="text-align: center; margin: 20px 0 40px 0;">
  <div style="position: relative; width: 100%; padding-bottom: 56.25%; height: 0; overflow: hidden;">
    <iframe style="position: absolute; top: 0; left: 0; width: 100%; height: 100%;" src="${youtubeUrl}" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>
  </div>
</div>

`;
  }

  // ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒãƒŠãƒ¼
  if (reviewItems.length > 0) {
    html += `<!-- ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒãƒŠãƒ¼ -->
<div class="kabag-review-banner">
  <a href="#judgeme_product_reviews">
  <div style="text-align: center; margin-bottom: 24px;">
    <p style="margin: 0; color: #E8960A; font-size: 12px; font-weight: bold; letter-spacing: 2px;">â˜… HIGH REVIEW â˜…</p>
    <p style="margin: 8px 0 0; color: #333; font-size: 20px; font-weight: 900; line-height: 1.4;">ãŠå®¢æ§˜ã®ãƒªã‚¢ãƒ«ãªå£°</p>
    <p style="margin: 4px 0 0; color: #888; font-size: 12px;">ãŸãã•ã‚“ã®æ–¹ã«é¸ã°ã‚Œã¦ã„ã¾ã™</p>
  </div>
`;
    reviewItems.forEach((r, idx) => {
      const captionBg = idx === 0 ? '#4A90A4' : '#4A90A4';
      html += `  <div class="kabag-review-card">
${r.isFirst ? '    <div style="position: absolute; top: -1px; left: 20px; background: #E8960A; color: #fff; font-size: 10px; font-weight: bold; padding: 3px 10px; border-radius: 0 0 6px 6px;">BEST REVIEW</div>\n' : ''}    <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 10px;${r.isFirst ? ' margin-top: 8px;' : ''}">
      <span style="color: #E8960A; font-size: 14px; letter-spacing: 2px;">â˜…â˜…â˜…â˜…â˜…</span>
    </div>
    <p style="margin: 0 0 6px; color: #333; font-size: 14px; font-weight: bold;">${r.title}</p>
    <p style="margin: 0; color: #555; font-size: 12px; line-height: 1.8;">${r.body}</p>
${r.tags ? `    <p style="margin: 6px 0 0; color: #aaa; font-size: 10px;">${r.tags}</p>\n` : ''}${r.caption ? `    <div class="kabag-review-caption" style="background: ${captionBg};">${r.caption}</div>\n` : ''}  </div>
`;
    });
    html += `  </a>
</div>

`;
  }

  // ãƒãƒŠãƒ¼ç”»åƒ
  if (bannerImages.length > 0) {
    html += `<!-- ãƒãƒŠãƒ¼ç”»åƒ -->\n`;
    bannerImages.forEach(b => {
      const imgTag = `<img src="${b.url}" alt="ãƒãƒŠãƒ¼" style="max-width: 100%; display: block;">`;
      if (b.link) {
        html += `<div style="text-align: center; margin: 10px 0;"><a href="${b.link}">${imgTag}</a></div>\n`;
      } else {
        html += `<div style="text-align: center; margin: 10px 0;">${imgTag}</div>\n`;
      }
    });
    html += `\n`;
  }

  // ã‚¢ã‚³ãƒ¼ãƒ‡ã‚£ã‚ªãƒ³ï¼ˆè³¼å…¥å‰=checkedï¼‰
  html += `<!-- ã‚¢ã‚³ãƒ¼ãƒ‡ã‚£ã‚ªãƒ³ -->
<div class="kabag-accordion">
  <input type="checkbox" id="acc1" checked>
  <label class="kabag-accordion-label" for="acc1">è³¼å…¥å‰ã«çŸ¥ã£ã¦ãŠããŸã„ã“ã¨</label>
  <div class="kabag-accordion-content">
`;
  beforePurchaseItems.forEach(item => { html += `    <p>â˜‘ï¸ ${item}</p>\n`; });
  html += `  </div>
</div>

<div class="kabag-accordion">
  <input type="checkbox" id="acc2">
  <label class="kabag-accordion-label" for="acc2">ã‚ˆãã‚ã‚‹è³ªå•</label>
  <div class="kabag-accordion-content">
`;
  faqItems.forEach((faq, index) => {
    const mt = index > 0 ? ' style="margin-top: 16px;"' : '';
    html += `    <p${mt}><strong>Qï¼š${faq.q}</strong><br>\n    Aï¼š${faq.a}</p>\n`;
  });
  html += `  </div>
</div>

<div class="kabag-accordion">
  <input type="checkbox" id="acc3">
  <label class="kabag-accordion-label" for="acc3">30æ—¥é–“è¿”é‡‘ä¿è¨¼ã«ã¤ã„ã¦</label>
  <div class="kabag-accordion-content">
    <p><strong>30æ—¥é–“è¿”é‡‘ä¿è¨¼ã®å¯¾è±¡ã¯ã€Œå±‹å†…è©¦ç”¨ã®ã¿ã€ã¨ãªã‚Šã¾ã™ã€‚</strong><br>
    è¿”é‡‘ã‚’ã”å¸Œæœ›ã®éš›ã¯ã€å•†å“åˆ°ç€å¾Œ30æ—¥ä»¥å†…ã«ã€è¿”é‡‘å¸Œæœ›ç”¨ç´™ã€‘ã‚’åŒæ¢±ã—ã€ç€æ‰•ã„ã«ã¦ã”è¿”é€ãã ã•ã„ã€‚</p>
    <div style="background: #f0f8f0; padding: 12px; border-radius: 6px; margin: 16px 0;">
      <p style="margin: 0 0 8px 0; color: #2e7d32;"><strong>âœ“ OKï¼ˆè¿”å“å¯¾è±¡ï¼‰</strong></p>
      <p style="margin: 0; font-size: 0.95em;">ãƒ»å®¤å†…ã§ã®åç´ãƒ†ã‚¹ãƒˆãƒ»ãƒãƒ¼ãƒç¢ºèª<br>ãƒ»é¡ã®å‰ã§ã®èƒŒè² ã„å¿ƒåœ°ãƒã‚§ãƒƒã‚¯<br>ãƒ»åºŠç½®ãã™ã‚‹å ´åˆã¯ã€ã‚·ãƒ¼ãƒˆç­‰ã‚’æ•·ã„ãŸã†ãˆã§çŸ­æ™‚é–“ã®ç¢ºèª</p>
    </div>
    <div style="background: #fef0f0; padding: 12px; border-radius: 6px; margin: 16px 0;">
      <p style="margin: 0 0 8px 0; color: #c62828;"><strong>âœ— NGï¼ˆè¿”é‡‘å¯¾è±¡å¤–ã¾ãŸã¯æ¸›é¡ï¼‰</strong></p>
      <p style="margin: 0; font-size: 0.95em;">ãƒ»å±‹å¤–ã§ã®æŒã¡å‡ºã—ãƒ»ä½¿ç”¨ï¼ˆé€šå‹¤ãƒ»é€šå­¦ãƒ»è²·ã„ç‰©ãƒ»æ—…è¡Œãƒ»æ’®å½±ãªã©ï¼‰<br>ãƒ»é›¨ãƒ»é›ªãƒ»æ°´æ¿¡ã‚Œã€è¡£é¡ã‚„ä»–è£½å“ã‹ã‚‰ã®è‰²ç§»ã‚Šã€åœ§è¿«ã«ã‚ˆã‚‹å¤‰å½¢<br>ãƒ»é¦™æ°´ãƒ»ãŠé¦™ãƒ»ã‚¿ãƒã‚³ç­‰ã®ã«ãŠã„ã®ä»˜ç€<br>ãƒ»ä»˜å±å“ï¼ˆç®±ãƒ»ã‚¿ã‚°ãƒ»èª¬æ˜æ›¸ï¼‰ã®æ¬ å“ãƒ»ç ´æ</p>
    </div>
    <p style="margin-top: 16px; font-size: 0.95em;"><strong>Q. ç„é–¢å…ˆã‚„ãƒ™ãƒ©ãƒ³ãƒ€ã§èƒŒè² ã„å¿ƒåœ°ã‚’ç¢ºèªã—ã¦ã‚‚å¤§ä¸ˆå¤«ã§ã™ã‹ï¼Ÿ</strong><br>A. å±‹å†…ã®ç¯„å›²ã§ã€çŸ­æ™‚é–“ã§ã‚ã‚Œã°å•é¡Œã‚ã‚Šã¾ã›ã‚“ã€‚</p>
    <p style="font-size: 0.95em;"><strong>Q. ã‚¿ã‚°ã‚’ä¸€åº¦å¤–ã—ã¦ã—ã¾ã£ã¦ã‚‚å¤§ä¸ˆå¤«ã§ã™ã‹ï¼Ÿ</strong><br>A. å•†å“ã®ä¾¡å€¤ã‚’å¤§ããæãªã‚ãªã„ç¯„å›²ã§ã‚ã‚Œã°åŸå‰‡ã¨ã—ã¦å—ã‘ä»˜ã‘ã¾ã™ã€‚ãŸã ã—ã€ã‚¿ã‚°ã¯ä¿ç®¡ã—ã€è¿”å“æ™‚ã«å¿…ãšåŒæ¢±ã—ã¦ãã ã•ã„ã€‚</p>
  </div>
</div>

`;

  // æ¨ªã‚¿ãƒ–ï¼ˆ2ã¤ã®ã¿ï¼‰
  html += `<!-- æ¨ªã‚¿ãƒ– -->
<div class="kabag-tabs-wrapper">
  <input type="radio" name="kabag-tabs" id="kabag-tab1" checked>
  <input type="radio" name="kabag-tabs" id="kabag-tab2">
  <div class="kabag-tabs-nav">
    <label for="kabag-tab1">å•†å“è©³ç´°</label>
    <label for="kabag-tab2">ã‚µã‚¤ã‚ºãƒ»ç´ æ</label>
  </div>
  
  <div class="kabag-tab-content tab1-content">
`;
  detailItems.forEach((detail, index) => {
    if (index === 0) {
      html += `    <div class="kabag-image-section kabag-main-visual">
      <img src="${detail.img}" alt="ãƒ¡ã‚¤ãƒ³ãƒ“ã‚¸ãƒ¥ã‚¢ãƒ«">
      <div class="kabag-title-block">
        ${productSubtitle ? `<p class="kabag-subtitle">${productSubtitle}</p>` : ''}
        ${productCategory ? `<p class="kabag-category">${productCategory}</p>` : ''}
        <p class="kabag-product-name">${productName}</p>
      </div>
    </div>
`;
    } else {
      html += `    <div class="kabag-image-section">
      <img src="${detail.img}" alt="å•†å“ç”»åƒ${index + 1}">
      ${detail.caption ? `<p>${detail.caption}</p>` : ''}
    </div>
`;
    }
  });

  if (sliderItems.length > 0) {
    html += `    <div class="kabag-slider">
      <p class="kabag-slider-title">å•†å“ä»•æ§˜ã‚®ãƒ£ãƒ©ãƒªãƒ¼</p>
      <div class="kabag-slider-wrapper">
        <span class="kabag-slider-arrow kabag-slider-arrow-left">ï¼œ</span>
        <span class="kabag-slider-arrow kabag-slider-arrow-right">ï¼</span>
        <div class="kabag-slider-container">
          <div class="kabag-slider-item" style="display: none;"></div>
`;
    sliderItems.forEach((item, index) => {
      html += `          <div class="kabag-slider-item" id="slide-${index}">
            <img src="${item.img}" alt="å•†å“ç”»åƒ${index + 1}">
            ${item.caption ? `<p class="kabag-slider-caption">${item.caption}</p>` : ''}
          </div>\n`;
    });
    html += `        </div>
      </div>
    </div>
`;
  }

  html += `  </div>
  
  <div class="kabag-tab-content tab2-content">
    <table style="width: 100%; border-collapse: collapse; font-size: 14px; margin-bottom: 30px;">
`;
  if (capacity) html += `      <tr style="border-bottom: 1px solid #e0e0e0;"><td style="padding: 12px 0; width: 35%; color: #888;">å®¹é‡</td><td style="padding: 12px 0;">ã€€${capacity}</td></tr>\n`;
  if (weight) html += `      <tr style="border-bottom: 1px solid #e0e0e0;"><td style="padding: 12px 0; color: #888;">é‡ã•</td><td style="padding: 12px 0;">ã€€${weight}</td></tr>\n`;
  if (size) html += `      <tr style="border-bottom: 1px solid #e0e0e0;"><td style="padding: 12px 0; color: #888;">ã‚µã‚¤ã‚º</td><td style="padding: 12px 0;">ã€€${size}</td></tr>\n`;
  if (materialMain) html += `      <tr style="border-bottom: 1px solid #e0e0e0;"><td style="padding: 12px 0; color: #888;">ç´ æï¼ˆæœ¬ä½“ï¼‰</td><td style="padding: 12px 0;">ã€€${materialMain}</td></tr>\n`;
  if (materialLining) html += `      <tr style="border-bottom: 1px solid #e0e0e0;"><td style="padding: 12px 0; color: #888;">ç´ æï¼ˆè£åœ°ï¼‰</td><td style="padding: 12px 0;">ã€€${materialLining}</td></tr>\n`;
  if (colorItems.length > 0) html += `      <tr style="border-bottom: 1px solid #e0e0e0;"><td style="padding: 12px 0; width: 35%; color: #888; vertical-align: top;">ã‚«ãƒ©ãƒ¼</td><td style="padding: 12px 0;">ã€€${colorItems.join('<br>ã€€')}</td></tr>\n`;
  if (productionPlace) html += `      <tr style="border-bottom: 1px solid #e0e0e0;"><td style="padding: 12px 0; color: #888;">ç”Ÿç”£åœ°</td><td style="padding: 12px 0;">ã€€${productionPlace}</td></tr>\n`;
  specOtherItems.forEach(item => { html += `      <tr style="border-bottom: 1px solid #e0e0e0;"><td style="padding: 12px 0; color: #888;">${item.label}</td><td style="padding: 12px 0;">ã€€${item.value}</td></tr>\n`; });
  html += `    </table>
    <p style="font-size: 0.9em; color: #888;">ã€æ³¨æ„äº‹é …ã€‘<br>ãƒ»ãƒ¢ãƒ‹ã‚¿ãƒ¼ç’°å¢ƒã«ã‚ˆã‚Šã€å®Ÿéš›ã®è‰²å‘³ã¨ç•°ãªã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ã€‚<br>ãƒ»å…‰ã®å½“ãŸã‚Šå…·åˆã«ã‚ˆã£ã¦ã‚‚ã€è‰²å‘³ãŒé•ã£ã¦è¦‹ãˆã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚</p>
  </div>
</div>

<!-- Judge.me ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆï¼ˆã‚¿ãƒ–å¤–ï¼‰ -->
<div id="judgeme_product_reviews" style="margin-top: 30px;">
  <div class="jdgm-widget jdgm-review-widget"></div>
</div>
`;
  return html;
}

function updatePreview() {
  const html = generateHTMLCode();
  const iframe = document.getElementById('previewIframe');
  const codeArea = document.getElementById('codePreview');
  const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
  iframeDoc.open();
  iframeDoc.write(`<!DOCTYPE html><html><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><style>body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; padding: 20px; margin: 0; }</style></head><body>${html}</body></html>`);
  iframeDoc.close();
  if (previewMode === 'code') codeArea.value = html;
}

function copyToClipboard() {
  const html = generateHTMLCode();
  navigator.clipboard.writeText(html).then(() => {
    const successMsg = document.getElementById('copySuccess');
    successMsg.style.display = 'block';
    setTimeout(() => { successMsg.style.display = 'none'; }, 2000);
  });
}

function downloadHTML() {
  const content = generateHTMLCode();
  const productName = document.getElementById('productName').value || 'kabag_product';
  const blob = new Blob([content], { type: 'text/html' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = `${productName.replace(/\s+/g, '_')}.html`;
  a.click();
  URL.revokeObjectURL(url);
}

window.onload = function() {
  loadJudgemeSettings();
  updatePreview();
};

// ===== Judge.me API =====
function saveJudgemeSettings() {
  const settings = {
    shopDomain: document.getElementById('judgemeShopDomain').value,
    apiToken: document.getElementById('judgemeApiToken').value
  };
  try { localStorage.setItem('kabag_judgeme_settings', JSON.stringify(settings)); showJudgemeStatus('è¨­å®šã‚’ä¿å­˜ã—ã¾ã—ãŸ', 'success'); } catch(e) { showJudgemeStatus('ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ', 'error'); }
}

function loadJudgemeSettings() {
  try {
    const saved = localStorage.getItem('kabag_judgeme_settings');
    if (saved) {
      const settings = JSON.parse(saved);
      document.getElementById('judgemeShopDomain').value = settings.shopDomain || '';
      document.getElementById('judgemeApiToken').value = settings.apiToken || '';
    }
  } catch(e) {}
}

function showJudgemeStatus(msg, type) {
  const el = document.getElementById('judgemeStatus');
  el.style.display = 'block';
  el.textContent = msg;
  el.style.background = type === 'success' ? '#e8f5e9' : type === 'error' ? '#fce4ec' : '#fff8e1';
  el.style.color = type === 'success' ? '#2e7d32' : type === 'error' ? '#c62828' : '#f57f17';
  if (type === 'success') setTimeout(() => { el.style.display = 'none'; }, 3000);
}

function extractProductHandle(input) {
  let value = input || '';
  // URLã‹ã‚‰ãƒãƒ³ãƒ‰ãƒ«ã‚’æŠ½å‡º
  const urlMatch = value.match(/\/products\/([a-z0-9\-]+)/i);
  if (urlMatch) return urlMatch[1];
  // ã™ã§ã«ãƒãƒ³ãƒ‰ãƒ«å½¢å¼ãªã‚‰ãã®ã¾ã¾
  return value.trim();
}

async function fetchJudgemeReviews() {
  const shopDomain = document.getElementById('judgemeShopDomain').value.trim();
  const apiToken = document.getElementById('judgemeApiToken').value.trim();
  const productHandleInput = document.getElementById('judgemeProductHandle').value.trim();
  
  if (!shopDomain || !apiToken) { showJudgemeStatus('Shop Domainã¨API Tokenã‚’å…¥åŠ›ã—ã¦ãã ã•ã„', 'error'); return; }
  if (!productHandleInput) { showJudgemeStatus('å•†å“URLã¾ãŸã¯ãƒãƒ³ãƒ‰ãƒ«ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„', 'error'); return; }
  
  const handle = extractProductHandle(productHandleInput);
  document.getElementById('judgemeProductHandle').value = handle;
  
  showJudgemeStatus('ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’å–å¾—ä¸­...', 'loading');
  
  try {
    // Widget APIã‚’ä½¿ç”¨ï¼ˆCORSå¯¾å¿œãƒ»Public Tokenå¯¾å¿œï¼‰
    const widgetUrl = `https://judge.me/api/v1/widgets/product_review?api_token=${encodeURIComponent(apiToken)}&shop_domain=${encodeURIComponent(shopDomain)}&handle=${encodeURIComponent(handle)}`;
    
    const response = await fetch(widgetUrl);
    if (!response.ok) throw new Error('APIå¿œç­”ã‚¨ãƒ©ãƒ¼: ' + response.status);
    
    const data = await response.json();
    
    if (data.widget) {
      const reviews = parseWidgetReviews(data.widget);
      if (reviews.length > 0) {
        populateReviewBanner(reviews.slice(0, 3));
        showJudgemeStatus(`${Math.min(reviews.length, 3)}ä»¶ã®â˜…5ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’å–å¾—ã—ã¾ã—ãŸï¼ã‚­ãƒ£ãƒ—ã‚·ãƒ§ãƒ³ã¯æ‰‹å‹•ã§è¿½åŠ ã—ã¦ãã ã•ã„`, 'success');
      } else {
        showJudgemeStatus('â˜…5ãƒ¬ãƒ“ãƒ¥ãƒ¼ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚å…¨ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‹ã‚‰å–å¾—ã‚’è©¦ã¿ã¾ã™...', 'loading');
        // æ˜Ÿ5ãŒãªã„å ´åˆã¯å…¨è©•ä¾¡ã‹ã‚‰å–å¾—
        const allReviews = parseWidgetReviews(data.widget, false);
        if (allReviews.length > 0) {
          populateReviewBanner(allReviews.slice(0, 3));
          showJudgemeStatus(`${Math.min(allReviews.length, 3)}ä»¶ã®ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’å–å¾—ã—ã¾ã—ãŸï¼ˆâ˜…5ä»¥å¤–ã‚’å«ã‚€ï¼‰ã€‚ã‚­ãƒ£ãƒ—ã‚·ãƒ§ãƒ³ã¯æ‰‹å‹•ã§è¿½åŠ ã—ã¦ãã ã•ã„`, 'success');
        } else {
          showJudgemeStatus('ãƒ¬ãƒ“ãƒ¥ãƒ¼ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚å•†å“ãƒãƒ³ãƒ‰ãƒ«ã‚’ç¢ºèªã—ã¦ãã ã•ã„', 'error');
        }
      }
    } else {
      showJudgemeStatus('ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒ‡ãƒ¼ã‚¿ãŒå–å¾—ã§ãã¾ã›ã‚“ã§ã—ãŸã€‚Shop Domainãƒ»Tokenãƒ»ãƒãƒ³ãƒ‰ãƒ«ã‚’ç¢ºèªã—ã¦ãã ã•ã„', 'error');
    }
  } catch (e) {
    console.error('Judge.me API error:', e);
    // CORSå¯¾ç­–ï¼šScriptã‚¿ã‚°ã§JSONPé¢¨ã«å–å¾—ã‚’è©¦ã¿ã‚‹
    try {
      showJudgemeStatus('åˆ¥ã®æ–¹æ³•ã§å–å¾—ã‚’è©¦ã¿ã¦ã„ã¾ã™...', 'loading');
      await fetchViaScript(shopDomain, apiToken, handle);
    } catch (e2) {
      showJudgemeStatus('å–å¾—ã‚¨ãƒ©ãƒ¼: APIã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã¾ã›ã‚“ã§ã—ãŸã€‚\n\nç¢ºèªäº‹é …ï¼š\nãƒ»Shop Domainã¯ã€Œâ—‹â—‹.myshopify.comã€å½¢å¼ã§ã™ã‹ï¼Ÿ\nãƒ»Public API Tokenã¯æ­£ã—ã„ã§ã™ã‹ï¼Ÿ\nãƒ»å•†å“ãƒãƒ³ãƒ‰ãƒ«ã¯æ­£ã—ã„ã§ã™ã‹ï¼Ÿ', 'error');
    }
  }
}

// ScriptåŸ‹ã‚è¾¼ã¿æ–¹å¼ã§ã®ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å–å¾—
function fetchViaScript(shopDomain, apiToken, handle) {
  return new Promise((resolve, reject) => {
    const callbackName = 'judgemeCallback_' + Date.now();
    const script = document.createElement('script');
    script.src = `https://judge.me/api/v1/widgets/product_review?api_token=${encodeURIComponent(apiToken)}&shop_domain=${encodeURIComponent(shopDomain)}&handle=${encodeURIComponent(handle)}&callback=${callbackName}`;
    
    window[callbackName] = function(data) {
      delete window[callbackName];
      document.head.removeChild(script);
      if (data && data.widget) {
        const reviews = parseWidgetReviews(data.widget);
        if (reviews.length > 0) {
          populateReviewBanner(reviews.slice(0, 3));
          showJudgemeStatus(`${Math.min(reviews.length, 3)}ä»¶ã®ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’å–å¾—ã—ã¾ã—ãŸï¼`, 'success');
        } else {
          const allReviews = parseWidgetReviews(data.widget, false);
          if (allReviews.length > 0) {
            populateReviewBanner(allReviews.slice(0, 3));
            showJudgemeStatus(`${Math.min(allReviews.length, 3)}ä»¶ã®ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’å–å¾—ã—ã¾ã—ãŸ`, 'success');
          } else {
            showJudgemeStatus('ãƒ¬ãƒ“ãƒ¥ãƒ¼ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸ', 'error');
          }
        }
        resolve();
      } else { reject(new Error('ãƒ‡ãƒ¼ã‚¿ãªã—')); }
    };
    
    script.onerror = () => { delete window[callbackName]; document.head.removeChild(script); reject(new Error('Scriptèª­ã¿è¾¼ã¿å¤±æ•—')); };
    setTimeout(() => { if (window[callbackName]) { delete window[callbackName]; try { document.head.removeChild(script); } catch(e){} reject(new Error('ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ')); } }, 10000);
    document.head.appendChild(script);
  });
}

function parseWidgetReviews(widgetHtml, onlyFiveStar = true) {
  const parser = new DOMParser();
  const doc = parser.parseFromString(widgetHtml, 'text/html');
  const reviewEls = doc.querySelectorAll('.jdgm-rev');
  const reviews = [];
  
  reviewEls.forEach(el => {
    const starsOn = el.querySelectorAll('.jdgm-star.jdgm--on').length;
    const dataScore = el.querySelector('[data-score]')?.getAttribute('data-score');
    const rating = starsOn || parseInt(dataScore) || 0;
    
    if (onlyFiveStar && rating < 5) return;
    if (!onlyFiveStar && rating < 4) return;
    
    const title = el.querySelector('.jdgm-rev__title')?.textContent.trim() || '';
    const body = el.querySelector('.jdgm-rev__body')?.textContent.trim() || '';
    if (title || body) reviews.push({ title, body, rating });
  });
  
  // é«˜è©•ä¾¡é †ã«ã‚½ãƒ¼ãƒˆ
  reviews.sort((a, b) => b.rating - a.rating);
  return reviews;
}

function populateReviewBanner(reviews) {
  const list = document.getElementById('reviewBannerList');
  list.innerHTML = '';
  
  reviews.forEach((review, idx) => {
    const item = document.createElement('div');
    item.className = 'dynamic-item review-item';
    
    const title = (review.title || '').replace(/"/g, '&quot;');
    const body = (review.body || '').replace(/</g, '&lt;').replace(/>/g, '&gt;');
    const reviewer = review.reviewer ? review.reviewer.name || '' : '';
    
    const bestTag = idx === 0 ? '<span style="background: #E8960A; color: #fff; font-size: 10px; font-weight: bold; padding: 2px 8px; border-radius: 4px;">BEST REVIEW</span>' : '';
    const stars = 'â˜…'.repeat(review.rating || 5);
    
    item.innerHTML = `<button type="button" class="delete-btn" onclick="deleteItem(this)">Ã—</button>
      <div style="display: flex; gap: 8px; margin-bottom: 8px; align-items: center;">
        ${bestTag}
        <span style="color: #E8960A; font-size: 13px;">${stars}</span>
      </div>
      <label>ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚¿ã‚¤ãƒˆãƒ«</label>
      <input type="text" class="review-title" value="${title}" oninput="updatePreview()">
      <label>ãƒ¬ãƒ“ãƒ¥ãƒ¼æœ¬æ–‡</label>
      <textarea class="review-body" oninput="updatePreview()">${body}</textarea>
      <label>å±æ€§ã‚¿ã‚°ï¼ˆä»»æ„ï¼‰</label>
      <input type="text" class="review-tags" placeholder="ä¾‹ï¼šå®Ÿç”¨å“ãƒ»æ™®æ®µä½¿ã„ï½œè‡ªåˆ†ç”¨ï½œãƒªãƒ”ãƒ¼ãƒˆ" oninput="updatePreview()">
      <label>ã‚­ãƒ£ãƒ—ã‚·ãƒ§ãƒ³ï¼ˆé’å¸¯ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ï¼‰</label>
      <input type="text" class="review-caption" placeholder="â€»æ‰‹å‹•ã§è¿½åŠ ã—ã¦ãã ã•ã„" oninput="updatePreview()">`;
    list.appendChild(item);
  });
  
  updatePreview();
}

function extractYoutubeUrl(input) {
  let value = input.value.trim();
  if (value.includes('<iframe') || value.includes('&lt;iframe')) {
    const srcMatch = value.match(/src=["']([^"']+)["']/);
    if (srcMatch && srcMatch[1]) { input.value = srcMatch[1].replace(/&amp;/g, '&'); }
  } else if (value.includes('youtube.com/watch') || value.includes('youtu.be/')) {
    let videoId = '';
    if (value.includes('youtube.com/watch')) { const urlParams = new URLSearchParams(value.split('?')[1]); videoId = urlParams.get('v'); }
    else if (value.includes('youtu.be/')) { videoId = value.split('youtu.be/')[1].split('?')[0].split('&')[0]; }
    if (videoId) input.value = 'https://www.youtube.com/embed/' + videoId;
  }
}

function parseHTMLSource() {
  const source = document.getElementById('htmlSource').value;
  if (!source.trim()) { alert('HTMLã‚½ãƒ¼ã‚¹ã‚’è²¼ã‚Šä»˜ã‘ã¦ãã ã•ã„'); return; }
  const parser = new DOMParser();
  const doc = parser.parseFromString(source, 'text/html');
  const title = doc.querySelector('h1')?.textContent || doc.querySelector('title')?.textContent || '';
  if (title) document.getElementById('productName').value = title.trim().replace(/\s+/g, ' ');
  const youtubeIframe = doc.querySelector('iframe[src*="youtube.com"], iframe[src*="youtu.be"]');
  if (youtubeIframe) { const src = youtubeIframe.getAttribute('src'); if (src) document.getElementById('youtubeUrl').value = src; }
  const images = doc.querySelectorAll('img[src*="cdn.shopify.com"]');
  const imageUrls = []; const seenUrls = new Set();
  images.forEach(img => { let src = img.getAttribute('src') || ''; if (src.startsWith('//')) src = 'https:' + src; if (src.includes('_small') || src.includes('_thumb') || src.includes('32x32') || src.includes('64x64')) return; const baseUrl = src.split('?')[0]; if (!seenUrls.has(baseUrl) && src.includes('files/')) { seenUrls.add(baseUrl); imageUrls.push(src); } });
  if (imageUrls.length > 0) {
    const imageGrid = document.getElementById('imageGrid'); imageGrid.innerHTML = '';
    imageUrls.forEach(url => { const div = document.createElement('div'); div.className = 'image-grid-item'; div.setAttribute('data-url', url); div.innerHTML = `<img src="${url}" onclick="toggleImageSelection(this.parentElement)"><div class="checkmark">âœ“</div>`; imageGrid.appendChild(div); });
    document.getElementById('extractedImages').style.display = 'block';
  }
  const bodyText = doc.body?.textContent || '';
  const detectedPoints = [];
  const patterns = [
    { regex: /17\s*ã‚¤ãƒ³ãƒ.*(?:PC|ãƒ‘ã‚½ã‚³ãƒ³|ãƒãƒ¼ãƒˆ).*(?:åç´|å¯¾å¿œ|OK)/i, text: '17ã‚¤ãƒ³ãƒã®PC åç´OK' },
    { regex: /15\s*ã‚¤ãƒ³ãƒ.*(?:PC|ãƒ‘ã‚½ã‚³ãƒ³|ãƒãƒ¼ãƒˆ).*(?:åç´|å¯¾å¿œ|OK)/i, text: '15ã‚¤ãƒ³ãƒã®PC åç´OK' },
    { regex: /13\s*ã‚¤ãƒ³ãƒ.*(?:PC|ãƒ‘ã‚½ã‚³ãƒ³|ãƒãƒ¼ãƒˆ).*(?:åç´|å¯¾å¿œ|OK)/i, text: '13ã‚¤ãƒ³ãƒã®PC åç´OK' },
    { regex: /A4.*(?:ãƒ•ã‚¡ã‚¤ãƒ«|ã‚µã‚¤ã‚º).*(?:åç´|å¯¾å¿œ|OK)/i, text: 'A4ãƒ•ã‚¡ã‚¤ãƒ« åç´OK' },
    { regex: /ãƒšãƒƒãƒˆãƒœãƒˆãƒ«.*(?:åç´|ãƒã‚±ãƒƒãƒˆ|OK)/i, text: 'ãƒšãƒƒãƒˆãƒœãƒˆãƒ«åç´OK' },
    { regex: /æ’¥æ°´/i, text: 'æ’¥æ°´åŠ å·¥' }, { regex: /ãƒ¡ãƒƒã‚·ãƒ¥.*ãƒã‚±ãƒƒãƒˆ/i, text: 'ãƒ¡ãƒƒã‚·ãƒ¥ãƒã‚±ãƒƒãƒˆã§ä¸­èº«ãŒè¦‹ãˆã‚‹' },
    { regex: /2\s*æ®µ.*æ§‹é€ |äºŒæ®µ.*æ§‹é€ |è¦³éŸ³é–‹ã/i, text: '2æ®µæ§‹é€ ã§æ•´ç†ã—ã‚„ã™ã„' },
    { regex: /è¦–èªæ€§/i, text: 'è¦–èªæ€§ã«å„ªã‚ŒãŸè¨­è¨ˆ' }, { regex: /è»½é‡|è»½ã„/i, text: 'è»½é‡è¨­è¨ˆ' },
    { regex: /ä¿å†·|ä¿æ¸©/i, text: 'ä¿å†·ãƒ»ä¿æ¸©æ©Ÿèƒ½ä»˜ã' }, { regex: /è‡ªç«‹/i, text: 'è‡ªç«‹ã™ã‚‹è¨­è¨ˆ' },
  ];
  patterns.forEach(p => { if (p.regex.test(bodyText)) detectedPoints.push(p.text); });
  const sizeMatch = bodyText.match(/(?:é«˜ã•|H)\s*[:ï¼š]?\s*(\d+)\s*(?:cm|ã)?\s*[Ã—x]\s*(?:æ¨ª|å¹…|W)\s*[:ï¼š]?\s*(\d+)\s*(?:cm|ã)?\s*[Ã—x]\s*(?:ãƒãƒ|å¥¥è¡Œ|D)\s*[:ï¼š]?\s*(\d+)/i);
  if (sizeMatch) document.getElementById('size').value = `é«˜ã•${sizeMatch[1]}cm Ã— æ¨ª${sizeMatch[2]}cm Ã— ãƒãƒ${sizeMatch[3]}cm`;
  const capacityMatch = bodyText.match(/(\d+)\s*[Lâ„“ãƒªãƒƒãƒˆãƒ«]/); if (capacityMatch) document.getElementById('capacity').value = capacityMatch[1] + 'L';
  const weightMatch = bodyText.match(/(\d+)\s*[gã‚°ãƒ©ãƒ ]/); if (weightMatch) document.getElementById('weight').value = weightMatch[1] + 'g';
  if (detectedPoints.length > 0) {
    const pointsList = document.getElementById('pointsList'); pointsList.innerHTML = '';
    detectedPoints.forEach(point => { const label = document.createElement('label'); label.style.cssText = 'display: flex; align-items: center; margin-bottom: 8px; cursor: pointer;'; label.innerHTML = `<input type="checkbox" checked value="${point}" style="margin-right: 8px; width: 16px; height: 16px;">${point}`; pointsList.appendChild(label); });
    document.getElementById('extractedPoints').style.display = 'block';
  }
  extractedCaptions = [];
  doc.querySelectorAll('p, h2, h3, .caption, .description').forEach(p => { const text = p.textContent.trim(); if (text.length > 10 && text.length < 100 && !text.includes('Qï¼š') && !text.includes('Aï¼š') && !extractedCaptions.includes(text)) extractedCaptions.push(text); });
  extractedColors = [];
  const colorMatches = bodyText.match(/(?:ãƒ–ãƒ©ãƒƒã‚¯|ãƒ›ãƒ¯ã‚¤ãƒˆ|ãƒã‚¤ãƒ“ãƒ¼|ã‚°ãƒ¬ãƒ¼|ãƒ™ãƒ¼ã‚¸ãƒ¥|ãƒ–ãƒ©ã‚¦ãƒ³|ãƒ€ãƒ¼ã‚¯ã‚°ãƒ¬ãƒ¼|ãƒ©ã‚¤ãƒˆã‚°ãƒ¬ãƒ¼|ãƒãƒ£ã‚³ãƒ¼ãƒ«|ã‚«ãƒ¼ã‚­)(?:ï¼ˆå†…è£…[^ï¼‰]+ï¼‰)?/g);
  if (colorMatches) colorMatches.forEach(c => { if (!extractedColors.includes(c)) extractedColors.push(c); });
  extractedSizes = [];
  [/(?:é«˜ã•|H)\s*[:ï¼š]?\s*\d+\s*(?:cm|ã)?\s*[Ã—x]\s*(?:æ¨ª|å¹…|W)\s*[:ï¼š]?\s*\d+\s*(?:cm|ã)?\s*[Ã—x]\s*(?:ãƒãƒ|å¥¥è¡Œ|D)\s*[:ï¼š]?\s*\d+\s*(?:cm|ã)?/gi, /\d+\s*(?:cm|ã)\s*[Ã—x]\s*\d+\s*(?:cm|ã)\s*[Ã—x]\s*\d+\s*(?:cm|ã)/gi].forEach(pattern => { const matches = bodyText.match(pattern); if (matches) matches.forEach(s => { const cleaned = s.trim(); if (!extractedSizes.includes(cleaned)) extractedSizes.push(cleaned); }); });
  if (extractedCaptions.length > 0) { document.getElementById('captionsList').innerHTML = extractedCaptions.map(c => `<div style="padding: 4px 0; border-bottom: 1px solid #eee;">â€¢ ${c}</div>`).join(''); document.getElementById('extractedCaptionsDiv').style.display = 'block'; }
  updatePreview();
  alert('è§£æå®Œäº†ï¼\nãƒ»å•†å“å: ' + (title ? 'æ¤œå‡º' : 'æœªæ¤œå‡º') + '\nãƒ»ç”»åƒ: ' + imageUrls.length + 'ä»¶\nãƒ»å•†å“ãƒã‚¤ãƒ³ãƒˆ: ' + detectedPoints.length + 'ä»¶\nãƒ»ã‚­ãƒ£ãƒ—ã‚·ãƒ§ãƒ³å€™è£œ: ' + extractedCaptions.length + 'ä»¶\nãƒ»ã‚«ãƒ©ãƒ¼å€™è£œ: ' + extractedColors.length + 'ä»¶');
}

function toggleImageSelection(item) { if (item.classList.contains('used')) return; item.classList.toggle('selected'); }

function applySelectedImages(target) {
  const selectedItems = document.querySelectorAll('#imageGrid .image-grid-item.selected');
  if (selectedItems.length === 0) { alert('ç”»åƒã‚’é¸æŠã—ã¦ãã ã•ã„'); return; }
  selectedItems.forEach((item, index) => { const url = item.getAttribute('data-url'); if (target === 'detail') addDetailItemWithUrl(url, index === 0); else addSliderItemWithUrl(url, index === 0); item.classList.remove('selected'); item.classList.add('used'); });
  updatePreview();
  alert(selectedItems.length + 'ä»¶ã®ç”»åƒã‚’è¿½åŠ ã—ã¾ã—ãŸã€‚');
}

function addDetailItemWithUrl(url, showSuggest = false) {
  const list = document.getElementById('productDetailList');
  const item = document.createElement('div');
  item.className = 'dynamic-item'; item.draggable = true; item.ondragstart = dragStart; item.ondragover = dragOver; item.ondrop = function(e) { drop(e, 'productDetailList'); }; item.ondragend = dragEnd;
  item.innerHTML = `<button type="button" class="delete-btn" onclick="deleteItem(this)">Ã—</button><div class="image-item-wrapper"><div class="move-buttons"><button type="button" class="move-btn" onclick="moveItem(this, -1)">â–²</button><button type="button" class="move-btn" onclick="moveItem(this, 1)">â–¼</button></div><img src="${url}" class="image-thumbnail" onerror="this.style.display='none'"><div class="image-inputs"><label>ç”»åƒURL</label><input type="url" class="detail-img" value="${url}" oninput="updatePreview(); updateThumbnail(this, 'detail')"><label>ã‚­ãƒ£ãƒ—ã‚·ãƒ§ãƒ³ <button type="button" class="auto-generate-btn" onclick="generateCaption(this)">âœ¨ è‡ªå‹•ç”Ÿæˆ</button></label><textarea class="detail-caption" placeholder="ã‚­ãƒ£ãƒ—ã‚·ãƒ§ãƒ³ã‚’å…¥åŠ›" oninput="updatePreview()"></textarea></div></div>`;
  list.appendChild(item);
  if (showSuggest && extractedCaptions.length > 0) setTimeout(() => { const btn = item.querySelector('.auto-generate-btn'); if (btn) generateCaption(btn); }, 100);
}

function addSliderItemWithUrl(url, showSuggest = false) {
  const list = document.getElementById('sliderList');
  const item = document.createElement('div');
  item.className = 'dynamic-item'; item.draggable = true; item.ondragstart = dragStart; item.ondragover = dragOver; item.ondrop = function(e) { drop(e, 'sliderList'); }; item.ondragend = dragEnd;
  item.innerHTML = `<button type="button" class="delete-btn" onclick="deleteItem(this)">Ã—</button><div class="image-item-wrapper"><div class="move-buttons"><button type="button" class="move-btn" onclick="moveItem(this, -1)">â–²</button><button type="button" class="move-btn" onclick="moveItem(this, 1)">â–¼</button></div><img src="${url}" class="image-thumbnail" onerror="this.style.display='none'"><div class="image-inputs"><label>ç”»åƒURL</label><input type="url" class="slider-img" value="${url}" oninput="updatePreview(); updateThumbnail(this, 'slider')"><label>ã‚­ãƒ£ãƒ—ã‚·ãƒ§ãƒ³ <button type="button" class="auto-generate-btn" onclick="generateCaption(this)">âœ¨ è‡ªå‹•ç”Ÿæˆ</button></label><input type="text" class="slider-caption" placeholder="ã‚­ãƒ£ãƒ—ã‚·ãƒ§ãƒ³ã‚’å…¥åŠ›" oninput="updatePreview()"></div></div>`;
  list.appendChild(item);
  if (showSuggest && extractedCaptions.length > 0) setTimeout(() => { const btn = item.querySelector('.auto-generate-btn'); if (btn) generateCaption(btn); }, 100);
}

function applySelectedPoints() {
  const checkboxes = document.querySelectorAll('#pointsList input[type="checkbox"]:checked');
  if (checkboxes.length === 0) { alert('ãƒã‚¤ãƒ³ãƒˆã‚’é¸æŠã—ã¦ãã ã•ã„'); return; }
  const bpCheckboxes = document.querySelectorAll('#beforePurchaseCheckboxes input[type="checkbox"]');
  checkboxes.forEach(cb => { let found = false; bpCheckboxes.forEach(bpc => { if (bpc.value === cb.value) { bpc.checked = true; found = true; } }); if (!found) addBeforePurchaseItemWithValue(cb.value); });
  updatePreview();
  alert(checkboxes.length + 'ä»¶åæ˜ ã—ã¾ã—ãŸ');
}

function updateThumbnail(input, type) {
  const url = input.value;
  const wrapper = input.closest('.image-item-wrapper');
  let thumbnail = wrapper.querySelector('.image-thumbnail');
  let placeholder = wrapper.querySelector('.image-thumbnail-placeholder');
  if (url && url.startsWith('http')) {
    if (placeholder) { const img = document.createElement('img'); img.src = url; img.className = 'image-thumbnail'; img.onerror = function() { this.style.display = 'none'; }; placeholder.replaceWith(img); }
    else if (thumbnail) { thumbnail.src = url; thumbnail.style.display = 'block'; }
  } else { if (thumbnail) { const div = document.createElement('div'); div.className = 'image-thumbnail-placeholder'; div.innerHTML = 'ç”»åƒ<br>ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼'; thumbnail.replaceWith(div); } }
}

function loadCreatedHTML() {
  try {
    const htmlSource = document.getElementById('editHtmlSource').value;
    if (!htmlSource.trim()) { alert('HTMLã‚³ãƒ¼ãƒ‰ã‚’è²¼ã‚Šä»˜ã‘ã¦ãã ã•ã„'); return; }
    const parser = new DOMParser();
    const doc = parser.parseFromString(htmlSource, 'text/html');
    resetForm();
    const youtubeIframe = doc.querySelector('iframe[src*="youtube"]');
    if (youtubeIframe) document.getElementById('youtubeUrl').value = youtubeIframe.getAttribute('src') || '';
    const subtitle = doc.querySelector('.kabag-subtitle');
    const category = doc.querySelector('.kabag-category');
    const productNameEl = doc.querySelector('.kabag-product-name');
    if (subtitle) document.getElementById('productSubtitle').value = subtitle.textContent.trim();
    if (category) document.getElementById('productCategory').value = category.textContent.trim();
    if (productNameEl) document.getElementById('productName').value = productNameEl.textContent.trim();
    // ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒãƒŠãƒ¼èª­ã¿è¾¼ã¿
    const reviewCards = doc.querySelectorAll('.kabag-review-card');
    if (reviewCards.length > 0) {
      const reviewList = document.getElementById('reviewBannerList');
      reviewList.innerHTML = '';
      reviewCards.forEach((card, idx) => {
        const title = card.querySelector('p[style*="font-weight: bold"]')?.textContent.trim() || '';
        const body = card.querySelector('p[style*="line-height: 1.8"]')?.textContent.trim() || '';
        const tags = card.querySelector('p[style*="color: #aaa"]')?.textContent.trim() || '';
        const caption = card.querySelector('.kabag-review-caption')?.textContent.trim() || '';
        const item = document.createElement('div');
        item.className = 'dynamic-item review-item';
        const bestTag = idx === 0 ? '<span style="background: #E8960A; color: #fff; font-size: 10px; font-weight: bold; padding: 2px 8px; border-radius: 4px;">BEST REVIEW</span>' : '';
        item.innerHTML = `<button type="button" class="delete-btn" onclick="deleteItem(this)">Ã—</button>
          <div style="display: flex; gap: 8px; margin-bottom: 8px; align-items: center;">${bestTag}<span style="color: #E8960A; font-size: 13px;">â˜…â˜…â˜…â˜…â˜…</span></div>
          <label>ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚¿ã‚¤ãƒˆãƒ«</label><input type="text" class="review-title" value="${title}" oninput="updatePreview()">
          <label>ãƒ¬ãƒ“ãƒ¥ãƒ¼æœ¬æ–‡</label><textarea class="review-body" oninput="updatePreview()">${body}</textarea>
          <label>å±æ€§ã‚¿ã‚°ï¼ˆä»»æ„ï¼‰</label><input type="text" class="review-tags" value="${tags}" oninput="updatePreview()">
          <label>ã‚­ãƒ£ãƒ—ã‚·ãƒ§ãƒ³</label><input type="text" class="review-caption" value="${caption}" oninput="updatePreview()">`;
        reviewList.appendChild(item);
      });
    }
    // ãƒãƒŠãƒ¼ç”»åƒèª­ã¿è¾¼ã¿
    const bannerImgs = doc.querySelectorAll('.kabag-review-banner ~ div img[alt="ãƒãƒŠãƒ¼"]');
    // TODO: ãƒãƒŠãƒ¼ç”»åƒã®èª­ã¿è¾¼ã¿ã¯å°†æ¥å®Ÿè£…
    
    const acc1Content = doc.querySelector('#acc1 ~ .kabag-accordion-content');
    if (acc1Content) {
      const items = acc1Content.querySelectorAll('p');
      const checkboxGroup = document.getElementById('beforePurchaseCheckboxes');
      items.forEach(p => { const text = p.textContent.replace(/^â˜‘ï¸\s*/, '').trim(); const cb = checkboxGroup.querySelector(`input[value="${text}"]`); if (cb) cb.checked = true; else addBeforePurchaseItemWithValue(text); });
    }
    const acc2Content = doc.querySelector('#acc2 ~ .kabag-accordion-content');
    if (acc2Content) {
      const faqList = document.getElementById('faqList'); faqList.innerHTML = '';
      acc2Content.querySelectorAll('p').forEach(p => {
        const html = p.innerHTML; const qMatch = html.match(/Qï¼š([^<]+)/); const aMatch = html.match(/Aï¼š(.+)$/);
        if (qMatch && aMatch) { const item = document.createElement('div'); item.className = 'dynamic-item'; item.innerHTML = `<button type="button" class="delete-btn" onclick="deleteItem(this)">Ã—</button><label>è³ªå•</label><input type="text" class="faq-q" value="${qMatch[1].trim()}" oninput="updatePreview()"><label>å›ç­”</label><textarea class="faq-a" oninput="updatePreview()">${aMatch[1].trim()}</textarea>`; faqList.appendChild(item); }
      });
    }
    const detailSections = doc.querySelectorAll('.kabag-image-section');
    if (detailSections.length > 0) {
      const detailList = document.getElementById('productDetailList'); detailList.innerHTML = '';
      detailSections.forEach(section => { const img = section.querySelector('img'); const captionP = section.querySelector('p:not(.kabag-subtitle):not(.kabag-category):not(.kabag-product-name)'); const titleBlock = section.querySelector('.kabag-title-block'); if (img) { addDetailItemWithUrl(img.getAttribute('src') || '', false); if (captionP && !titleBlock) { const lastItem = detailList.lastElementChild; if (lastItem) lastItem.querySelector('.detail-caption').value = captionP.textContent.trim(); } } });
    }
    const sliderItemEls = doc.querySelectorAll('.kabag-slider-item');
    if (sliderItemEls.length > 0) {
      const sliderList = document.getElementById('sliderList'); sliderList.innerHTML = '';
      sliderItemEls.forEach(item => { const img = item.querySelector('img'); const caption = item.querySelector('.kabag-slider-caption'); if (img) { addSliderItemWithUrl(img.getAttribute('src') || '', false); if (caption) { const lastItem = sliderList.lastElementChild; if (lastItem) lastItem.querySelector('.slider-caption').value = caption.textContent.trim(); } } });
    }
    const table = doc.querySelector('.tab2-content table');
    if (table) {
      table.querySelectorAll('tr').forEach(row => {
        const label = row.querySelector('td:first-child')?.textContent.trim();
        const value = row.querySelector('td:last-child')?.textContent.replace(/^ã€€/, '').trim();
        if (label && value) {
          switch(label) { case 'å®¹é‡': document.getElementById('capacity').value = value; break; case 'é‡ã•': document.getElementById('weight').value = value; break; case 'ã‚µã‚¤ã‚º': document.getElementById('size').value = value; break;
            case 'ç´ æï¼ˆæœ¬ä½“ï¼‰': setMaterialValue('materialMain', 'materialMainOther', value); break; case 'ç´ æï¼ˆè£åœ°ï¼‰': setMaterialValue('materialLining', 'materialLiningOther', value); break;
            case 'ã‚«ãƒ©ãƒ¼': const colorList = document.getElementById('colorList'); colorList.innerHTML = ''; value.split(/\n/).forEach(c => { if (c.trim()) { const item = document.createElement('div'); item.className = 'dynamic-item color-item'; item.innerHTML = `<button type="button" class="delete-btn" onclick="deleteItem(this)">Ã—</button><input type="text" class="color-input" value="${c.trim()}" oninput="updatePreview()">`; colorList.appendChild(item); } }); break;
            case 'ç”Ÿç”£åœ°': setProductionPlace(value); break; }
        }
      });
    }
    updatePreview();
    alert('HTMLã‚’èª­ã¿è¾¼ã¿ã¾ã—ãŸï¼');
  } catch (e) { alert('ã‚¨ãƒ©ãƒ¼: ' + e.message); console.error(e); }
}

function setMaterialValue(selectId, otherId, value) {
  const select = document.getElementById(selectId); const otherInput = document.getElementById(otherId); const otherDiv = document.getElementById('other' + selectId.charAt(0).toUpperCase() + selectId.slice(1));
  let found = false; for (let option of select.options) { if (option.value === value) { select.value = value; found = true; break; } }
  if (!found && value) { select.value = 'other'; otherInput.value = value; if (otherDiv) otherDiv.classList.add('active'); }
}
function setProductionPlace(value) {
  const select = document.getElementById('productionPlace'); const otherInput = document.getElementById('productionPlaceOther'); const otherDiv = document.getElementById('otherProductionPlace');
  let found = false; for (let option of select.options) { if (option.value === value) { select.value = value; found = true; break; } }
  if (!found && value) { select.value = 'other'; otherInput.value = value; otherDiv.classList.add('active'); }
}
function resetForm() {
  document.getElementById('productSubtitle').value = ''; document.getElementById('productCategory').value = ''; document.getElementById('productName').value = ''; document.getElementById('youtubeUrl').value = '';
  document.querySelectorAll('#beforePurchaseCheckboxes input[type="checkbox"]').forEach(cb => { cb.checked = cb.value === '30æ—¥é–“è¿”é‡‘ä¿è¨¼â€¼ï¸' || cb.value === 'å…¨å›½é€æ–™ç„¡æ–™â€¼ï¸'; });
  document.getElementById('beforePurchaseList').innerHTML = '<p style="font-size: 0.85em; color: #666; margin: 0 0 8px 0;">ãã®ä»–ã®é …ç›®ï¼š</p>';
  document.getElementById('faqList').innerHTML = ''; document.getElementById('productDetailList').innerHTML = ''; document.getElementById('sliderList').innerHTML = ''; document.getElementById('colorList').innerHTML = '';
  document.getElementById('capacity').value = ''; document.getElementById('weight').value = ''; document.getElementById('size').value = ''; document.getElementById('materialMain').value = ''; document.getElementById('materialLining').value = ''; document.getElementById('productionPlace').value = '';
  document.querySelectorAll('.other-input').forEach(div => div.classList.remove('active'));
  // ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒãƒŠãƒ¼ãƒªã‚»ãƒƒãƒˆ
  document.getElementById('reviewBannerList').innerHTML = `<div class="dynamic-item review-item"><button type="button" class="delete-btn" onclick="deleteItem(this)">Ã—</button><div style="display: flex; gap: 8px; margin-bottom: 8px; align-items: center;"><span style="background: #E8960A; color: #fff; font-size: 10px; font-weight: bold; padding: 2px 8px; border-radius: 4px;">BEST REVIEW</span><span style="color: #E8960A; font-size: 13px;">â˜…â˜…â˜…â˜…â˜…</span></div><label>ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚¿ã‚¤ãƒˆãƒ«</label><input type="text" class="review-title" placeholder="ä¾‹ï¼šä½•åº¦ã‚‚ãƒªãƒ”ã—ã¦ã¾ã™" oninput="updatePreview()"><label>ãƒ¬ãƒ“ãƒ¥ãƒ¼æœ¬æ–‡</label><textarea class="review-body" placeholder="ä¾‹ï¼šã¨ã«ã‹ãä½¿ã„ã‚„ã™ã„..." oninput="updatePreview()"></textarea><label>å±æ€§ã‚¿ã‚°ï¼ˆä»»æ„ï¼‰</label><input type="text" class="review-tags" placeholder="ä¾‹ï¼šå®Ÿç”¨å“ãƒ»æ™®æ®µä½¿ã„ï½œè‡ªåˆ†ç”¨ï½œãƒªãƒ”ãƒ¼ãƒˆ" oninput="updatePreview()"><label>ã‚­ãƒ£ãƒ—ã‚·ãƒ§ãƒ³ï¼ˆé’å¸¯ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ï¼‰</label><input type="text" class="review-caption" placeholder="ä¾‹ï¼šãƒªãƒ”ãƒ¼ãƒˆç¶šå‡ºï¼ã‚³ãƒ³ãƒ‘ã‚¯ãƒˆãªã®ã«å¤§å®¹é‡" oninput="updatePreview()"></div>`;
  document.getElementById('bannerImageList').innerHTML = '';
}

let draggedItem = null;
function dragStart(e) { draggedItem = e.target.closest('.dynamic-item'); draggedItem.classList.add('dragging'); e.dataTransfer.effectAllowed = 'move'; }
function dragOver(e) { e.preventDefault(); const item = e.target.closest('.dynamic-item'); if (item && item !== draggedItem) item.classList.add('drag-over'); }
function dragEnd(e) { document.querySelectorAll('.dynamic-item').forEach(item => { item.classList.remove('dragging', 'drag-over'); }); draggedItem = null; }
function drop(e, listId) {
  e.preventDefault(); const dropTarget = e.target.closest('.dynamic-item'); const list = document.getElementById(listId);
  if (dropTarget && draggedItem && dropTarget !== draggedItem) { const items = Array.from(list.children); const draggedIndex = items.indexOf(draggedItem); const dropIndex = items.indexOf(dropTarget); if (draggedIndex < dropIndex) dropTarget.after(draggedItem); else dropTarget.before(draggedItem); updatePreview(); }
  document.querySelectorAll('.dynamic-item').forEach(item => { item.classList.remove('drag-over'); });
}
function moveItem(btn, direction) {
  const item = btn.closest('.dynamic-item'); const list = item.parentElement; const items = Array.from(list.children); const index = items.indexOf(item);
  if (direction === -1 && index > 0) list.insertBefore(item, items[index - 1]); else if (direction === 1 && index < items.length - 1) list.insertBefore(items[index + 1], item);
  updatePreview();
}
</script>

</body>
</html>
